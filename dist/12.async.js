(window["webpackJsonp"]=window["webpackJsonp"]||[]).push([[12],{"7Zm1":function(e,t,a){e.exports={trendItem:"antd-pro-components-trend-index-trendItem",down:"antd-pro-components-trend-index-down",up:"antd-pro-components-trend-index-up",trendItemGrey:"antd-pro-components-trend-index-trendItemGrey",reverseColor:"antd-pro-components-trend-index-reverseColor"}},E6K0:function(e,t,a){"use strict";var d=a("TqRt"),l=a("284h");Object.defineProperty(t,"__esModule",{value:!0}),t.default=void 0,a("IzEo");var n=d(a("bx4M"));a("14J3");var r=d(a("BMrR"));a("5Dmo");var s=d(a("3S7+"));a("Pwec");var i=d(a("CtXQ"));a("jCWc");var u=d(a("kPKH")),o=d(a("MVZn")),c=d(a("lwsE")),f=d(a("W8MJ")),m=d(a("a1gu")),y=d(a("Nsbk")),h=d(a("7W2i"));a("Znn+");var g=d(a("ZTPi"));a("iQDF");var p=d(a("+eQT"));a("OaEy");var v=d(a("2fM7")),R=l(a("q1tI")),E=a("MuoO"),k=a("LLXN"),C=a("34ay"),b=d(a("ZhIB")),M=(d(a("4IMT")),a("KTCi")),I=d(a("v99g")),B=a("+n12"),D=d(a("YR7N")),x=d(a("rBGm")),w=(a("eHHv"),a("PQp+"),a("1pet"),a("+n12"),d(a("wd/R")));a("f0Wu");d(a("fqRC")),v.default.Option;var N,P,S=p.default.RangePicker,A={xs:24,sm:12,md:12,lg:12,xl:6,style:{marginBottom:24}},T=(0,C.getAuthority)(),W=g.default.TabPane,F=(N=(0,E.connect)(function(e){var t=e.areas,a=e.dashboard,d=(e.geo,e.loading);e.chart;return{dashboard:a,selectedAreaId:t.selectedAreaId,areaNames:t.areaNames,barChartloading:d.models.areas||d.effects["dashboard/fetchRideCount"]||d.effects["dashboard/fetchCustomerCount"],activeRideCountLoading:d.models.areas||d.effects["dashboard/fetchDailyRideCounts"],weeklyBatteryStateLoading:d.models.areas||d.effects["dashboard/fetchWeeklyBatteryState"],revenueLoading:d.models.areas||d.effects["dashboard/fetchStripeDailyRevenue"],currentActiveRideLoading:d.models.areas||d.effects["dashboard/fetchDailyRideCounts"],weeklyBatterySwapLoading:d.models.areas||d.effects["dashboard/fetchDailyRideCounts"],dailyRideRevenueLoading:d.models.areas||d.effects["dashboard/fetchDailyRideRevenue"]}}),N(P=function(e){function t(e){var a;return(0,c.default)(this,t),a=(0,m.default)(this,(0,y.default)(t).call(this,e)),a.state={rangePickerValue:(0,B.getTimeDistance)("month"),offset:(new Date).getTimezoneOffset()/-60+1,countParams:{period:"month"}},a.setClickedMarker=function(e){a.setState({selectedMarker:e})},a.selectDate=function(e){a.props.dispatch;a.setState({countParams:(0,o.default)({},a.state.rideCountParams,{period:e}),rangePickerValue:(0,B.getTimeDistance)(e)},a.loadBarCharData)},a.handleRangePickerChange=function(e){a.props.dispatch;a.setState({rangePickerValue:e},a.loadBarCharData)},a.getRankingBoard=function(){var e=a.props,t=e.dashboard,d=e.areaNames;return T.includes("get.ride.vehicle.rank")&&R.default.createElement(u.default,{xl:8,lg:12,md:12,sm:24,xs:24},R.default.createElement("div",{className:x.default.salesRank},R.default.createElement("h4",{className:x.default.rankingTitle},R.default.createElement(k.FormattedMessage,{id:"app.dashboard.rides-ranking",defaultMessage:"Rides Ranking"})),R.default.createElement("ul",{className:x.default.rankingList,style:{height:200,marginBottom:"20px",overflow:"scroll"}},t.ridePerVehicleRank.map(function(e,t){return R.default.createElement("li",{key:e.areaId},R.default.createElement("span",{className:"".concat(x.default.rankingItemNumber," ").concat(t<3?x.default.active:"")},t+1),R.default.createElement("span",{className:x.default.rankingItemTitle,title:d[e.areaId]},d[e.areaId]),R.default.createElement("span",{className:x.default.rankingItemValue},(0,b.default)(e.avgRides).format("0,0.00")))}))))},a}return(0,h.default)(t,e),(0,f.default)(t,[{key:"componentDidMount",value:function(){var e=this;this.props.selectedAreaId,this.props.dispatch;this.reqRef=requestAnimationFrame(function(){e.loadBarCharData(),e.loadDailyRideCount(),e.loadWeeklyBatteryStatus(),e.loadStripeRevenue(),e.loadDailyRideRevenue(),e.timeoutId=setTimeout(function(){e.setState({loading:!1})},2e3),e.pollingId=setInterval(function(){e.loadDailyRideCount(),e.loadWeeklyBatteryStatus(),e.loadDailyRideRevenue(),e.loadStripeRevenue(),e.setState({areaIsChanged:!1})},3e4)})}},{key:"componentWillUnmount",value:function(){var e=this.props.dispatch;e({type:"dashboard/clear"}),cancelAnimationFrame(this.reqRef),clearTimeout(this.timeoutId),clearInterval(this.pollingId)}},{key:"loadBarCharData",value:function(){this.fetchRideCount(),this.fetchCustomerCount(),this.getStripeRevenueByPeriod(),this.fetchRidePerVehicleRank(),this.getConnectivityByPeriod()}},{key:"loadDailyRideCount",value:function(){var e=this.props,t=e.dispatch,a=e.selectedAreaId;T.includes("get.daily.ride.count")&&t({type:"dashboard/fetchDailyRideCounts",params:{areaId:a,midnight:(0,w.default)().tz("America/Chicago").startOf("day").unix()}})}},{key:"loadRideDailyRevenue",value:function(){var e=this.props,t=e.dispatch,a=e.selectedAreaId;T.includes("get.daily.ride.revenue")&&t({type:"dashboard/fetchDailyRideRevenue",params:{areaId:a,midnight:(0,w.default)().tz("America/Chicago").startOf("day").unix()}})}},{key:"loadStripeRevenue",value:function(){var e=this.props,t=e.dispatch,a=e.selectedAreaId;T.includes("get.stripe.revenue")&&t({type:"dashboard/fetchStripeDailyRevenue",params:{areaId:a,midnight:(0,w.default)().tz("America/Chicago").startOf("day").unix()}})}},{key:"loadDailyRideRevenue",value:function(){var e=this.props,t=e.dispatch,a=e.selectedAreaId;T.includes("get.daily.ride.revenue")&&t({type:"dashboard/fetchDailyRideRevenue",params:{areaId:a,midnight:(0,w.default)().tz("America/Chicago").startOf("day").unix()}})}},{key:"loadWeeklyBatteryStatus",value:function(){var e=this.props,t=e.dispatch,a=e.selectedAreaId,d=this.state.offset;T.includes("get.weekly.battery.state")&&t({type:"dashboard/fetchWeeklyBatteryState",params:{areaId:a,midnight:(0,w.default)().subtract(7,"d").unix(),offset:d}})}},{key:"getRangeEnd",value:function(e){var t=(0,w.default)();return e.diff(t,"seconds")>0?t:e}},{key:"fetchRideCount",value:function(){var e=this.props,t=e.dispatch,a=e.selectedAreaId,d=this.state,l=d.countParams,n=d.offset,r=d.rangePickerValue;T.includes("get.ride.count")&&t({type:"dashboard/fetchRideCount",params:Object.assign({},l,{offset:n,areaId:a,start:r[0].unix(),end:r[1].unix()})})}},{key:"fetchCustomerCount",value:function(){var e=this.props,t=e.dispatch,a=e.selectedAreaId,d=this.state,l=d.countParams,n=d.offset,r=d.rangePickerValue;T.includes("get.customer.count")&&t({type:"dashboard/fetchCustomerCount",params:Object.assign({},l,{offset:n,areaId:a,start:r[0].unix(),end:r[1].unix()})})}},{key:"getStripeRevenueByPeriod",value:function(){var e=this.props,t=e.dispatch,a=e.selectedAreaId,d=this.state,l=d.countParams,n=d.offset,r=d.rangePickerValue;T.includes("get.stripe.revenue.by.period")&&t({type:"dashboard/fetchStripRevenueByPeriod",params:Object.assign({},l,{offset:n,areaId:a||-1,start:r[0].unix(),end:r[1].unix()})})}},{key:"getConnectivityByPeriod",value:function(){var e=this.props,t=e.dispatch,a=e.selectedAreaId,d=this.state,l=d.countParams,n=d.offset,r=d.rangePickerValue;T.includes("get.connectivity.by.period")&&t({type:"dashboard/fetchConnectivityByPeriod",params:Object.assign({},l,{offset:n,areaId:a||-1,start:r[0].unix(),end:r[1].unix()})})}},{key:"fetchRidePerVehicleRank",value:function(){var e=this.props,t=e.dispatch,a=(e.selectedAreaId,this.state),d=a.rangePickerValue,l=a.offset;T.includes("get.ride.vehicle.rank")&&t({type:"dashboard/getRidePerVehicleRank",params:Object.assign({},{start:d[0].unix(),end:d[1].unix(),offset:l})})}},{key:"componentDidUpdate",value:function(e,t,a){e.selectedAreaId!==this.props.selectedAreaId&&(this.loadBarCharData(),this.loadDailyRideCount(),this.loadWeeklyBatteryStatus(),this.loadDailyRideRevenue(),this.loadStripeRevenue(),this.setState({areaIsChanged:!1}))}},{key:"isActive",value:function(e){var t=this.state.rangePickerValue,a=(0,B.getTimeDistance)(e);return t[0]&&t[1]&&t[0].isSame(a[0],"day")&&t[1].isSame(a[1],"day")?x.default.currentDate:""}},{key:"render",value:function(){var e=this,t=this.props,a=(t.selectedAreaId,t.geo,t.areaNames,t.barChartloading),d=(t.activeRideCountLoading,t.dashboard),l=t.revenueLoading,o=(t.currentActiveRideLoading,t.weeklyBatterySwapLoading,t.dailyRideRevenueLoading),c=this.state,f=c.rangePickerValue,m=c.areaIsChanged,y=R.default.createElement("div",{className:x.default.salesExtraWrap},R.default.createElement("div",{className:x.default.salesExtra},R.default.createElement("a",{className:this.isActive("day"),onClick:function(){return e.selectDate("day")}},R.default.createElement(k.FormattedMessage,{id:"app.analysis.all-day",defaultMessage:"All Day"})),R.default.createElement("a",{className:this.isActive("week"),onClick:function(){return e.selectDate("week")}},R.default.createElement(k.FormattedMessage,{id:"app.analysis.all-week",defaultMessage:"All Week"})),R.default.createElement("a",{className:this.isActive("month"),onClick:function(){return e.selectDate("month")}},R.default.createElement(k.FormattedMessage,{id:"app.analysis.all-month",defaultMessage:"All Month"})),R.default.createElement("a",{className:this.isActive("year"),onClick:function(){return e.selectDate("year")}},R.default.createElement(k.FormattedMessage,{id:"app.analysis.all-year",defaultMessage:"All Year"}))),R.default.createElement(S,{value:f,onChange:this.handleRangePickerChange,style:{width:256}})),h=this.getRangeEnd(f[1]).diff(f[0],"days");0===h&&(h=1);var p=d.dailyRideCount,v=d.batteryState,E=d.stripeRevenue,C=d.dailyRideRevenue,B=v.weeklyBatterySwap&&v.weeklyBatterySwap.map(function(e){return{x:(0,w.default)().dayOfYear(e.dayOfYear).format("MM/DD"),y:e.total}});return R.default.createElement(I.default,null,R.default.createElement(r.default,{gutter:24,style:{marginTop:"2em"}},T.includes("get.daily.ride.count")&&R.default.createElement(u.default,A,R.default.createElement(M.ChartCard,{bordered:!1,title:"Current Active Rides",action:R.default.createElement(s.default,{title:"introduce"},R.default.createElement(i.default,{type:"info-circle-o"})),total:m?"loading":p.currentActiveRideCount,footer:R.default.createElement(M.Field,{label:"Total Ride Today",value:m?"loading":"".concat(p.todayRideCount)}),contentHeight:60},R.default.createElement(D.default,{flag:p.todayRideCount-p.lastWeekRideCount>0?"up":"down",style:{marginRight:16}},R.default.createElement(k.FormattedMessage,{id:"app.analysis.week",defaultMessage:"Weekly Changes"}),R.default.createElement("span",{className:x.default.trendText}," ",Math.round((p.todayRideCount-p.lastWeekRideCount)/p.lastWeekRideCount*100),"%")),R.default.createElement(D.default,{flag:p.todayRideCount-p.yesterdayRideCount>0?"up":"down"},R.default.createElement(k.FormattedMessage,{id:"app.analysis.day",defaultMessage:"Daily Changes"}),R.default.createElement("span",{className:x.default.trendText},Math.round((p.todayRideCount-p.yesterdayRideCount)/p.yesterdayRideCount*100),"%")))),T.includes("get.weekly.battery.state")&&B&&R.default.createElement(u.default,A,R.default.createElement(M.ChartCard,{bordered:!1,loading:!1,title:"Total Battery Swap Today",action:R.default.createElement(s.default,{title:R.default.createElement(k.FormattedMessage,{id:"app.analysis.introduce",defaultMessage:"introduce"})},R.default.createElement(i.default,{type:"info-circle-o"})),total:m?"loading":B[B.length-1]&&(0,b.default)(B[B.length-1].y).format("0,0"),footer:R.default.createElement(M.Field,{label:"Low Battery Vehicles",value:m?"loading":(0,b.default)(v.lowBatteryCount).format("0,0")}),contentHeight:60},R.default.createElement(M.MiniBar,{color:"#975FE4",data:B}))),T.includes("get.stripe.revenue")&&E&&R.default.createElement(u.default,A,R.default.createElement(M.ChartCard,{bordered:!1,title:"Today's Stripe Revenue",action:R.default.createElement(s.default,{title:"introduce"},R.default.createElement(i.default,{type:"info-circle-o"})),loading:o,total:o?"loading":E.dailyRevenue/100,footer:R.default.createElement(M.Field,{label:"Total Revenue",value:l?"loading":"".concat(E.totalRevenue/100)}),contentHeight:60},R.default.createElement(D.default,{flag:E.dailyRevenue-E.lastWeekRevenue>0?"up":"down",style:{marginRight:16}},R.default.createElement(k.FormattedMessage,{id:"app.analysis.week",defaultMessage:"Weekly Changes"}),R.default.createElement("span",{className:x.default.trendText}," ",l?"loading":Math.round((E.dailyRevenue-E.lastWeekRevenue)/E.lastWeekRevenue*100),"%")),R.default.createElement(D.default,{flag:E.dailyRevenue-E.yesterdayRevenue>0?"up":"down"},R.default.createElement(k.FormattedMessage,{id:"app.analysis.day",defaultMessage:"Daily Changes"}),R.default.createElement("span",{className:x.default.trendText},l?"loading":Math.round((E.dailyRevenue-E.yesterdayRevenue)/E.yesterdayRevenue*100),"%")))),T.includes("get.daily.ride.revenue")&&C&&R.default.createElement(u.default,A,R.default.createElement(M.ChartCard,{bordered:!1,title:"Today's Ride Revenue",action:R.default.createElement(s.default,{title:"introduce"},R.default.createElement(i.default,{type:"info-circle-o"})),loading:!1,total:m?"loading":C.dailyRevenue,footer:R.default.createElement(M.Field,{label:"Total Revenue",value:"".concat(C.totalRevenue)}),contentHeight:60},R.default.createElement(D.default,{flag:C.dailyRevenue-C.lastWeekRevenue>0?"up":"down",style:{marginRight:16}},R.default.createElement(k.FormattedMessage,{id:"app.analysis.week",defaultMessage:"Weekly Changes"}),R.default.createElement("span",{className:x.default.trendText}," ",Math.round((C.dailyRevenue-C.lastWeekRevenue)/C.lastWeekRevenue*100),"%")),R.default.createElement(D.default,{flag:C.dailyRevenue-C.yesterdayRevenue>0?"up":"down"},R.default.createElement(k.FormattedMessage,{id:"app.analysis.day",defaultMessage:"Daily Changes"}),R.default.createElement("span",{className:x.default.trendText},Math.round((C.dailyRevenue-C.yesterdayRevenue)/C.yesterdayRevenue*100),"%"))))),(T.includes("get.ride.count")||T.includes("get.ride.count"))&&R.default.createElement(n.default,{loading:a,bordered:!1,bodyStyle:{padding:0}},R.default.createElement("div",{className:x.default.salesCard},R.default.createElement(g.default,{tabBarExtraContent:y,size:"large",tabBarStyle:{marginBottom:24}},T.includes("get.ride.count")&&R.default.createElement(W,{tab:R.default.createElement(k.FormattedMessage,{id:"app.analysis.sales",defaultMessage:"Sales"}),key:"rides"},R.default.createElement(r.default,null,R.default.createElement(u.default,{xl:16,lg:12,md:12,sm:24,xs:24},R.default.createElement("div",{className:x.default.salesBar},R.default.createElement(M.Bar,{height:295,title:R.default.createElement(k.FormattedMessage,{id:"app.dashboard.rides-trend",defaultMessage:"Rides Trend"}),data:d.rideCountData}))),this.getRankingBoard())),T.includes("get.ride.count")&&R.default.createElement(W,{tab:R.default.createElement(k.FormattedMessage,{id:"app.dashboard.customers",defaultMessage:"Customers"}),key:"customers"},R.default.createElement(r.default,null,R.default.createElement(u.default,{xl:16,lg:12,md:12,sm:24,xs:24},R.default.createElement("div",{className:x.default.salesBar},R.default.createElement(M.Bar,{height:292,title:R.default.createElement(k.FormattedMessage,{id:"app.dashboard.customers-trend",defaultMessage:"Customer Trend"}),data:d.customerCountData}))),this.getRankingBoard())),T.includes("get.stripe.revenue.by.period")&&R.default.createElement(W,{tab:"Stripe Revenue",key:"revenue"},R.default.createElement(r.default,null,R.default.createElement(u.default,{xl:16,lg:12,md:12,sm:24,xs:24},R.default.createElement("div",{className:x.default.salesBar},R.default.createElement(M.Bar,{height:292,title:"Revenue Trend",data:d.stripeRevenueData}))),this.getRankingBoard())),T.includes("get.connectivity.by.period")&&R.default.createElement(W,{tab:"Vehicle Connectivity",key:"connectivity"},R.default.createElement(r.default,null,R.default.createElement(u.default,{xl:16,lg:12,md:12,sm:24,xs:24},R.default.createElement("div",{className:x.default.salesBar},R.default.createElement(M.Bar,{height:292,title:"Connectivity Trend",data:d.connectivity}))),this.getRankingBoard()))))))}}]),t}(R.Component))||P),V=F;t.default=V},YR7N:function(e,t,a){"use strict";var d=a("TqRt");Object.defineProperty(t,"__esModule",{value:!0}),t.default=void 0;var l=d(a("pVnL"));a("Pwec");var n=d(a("CtXQ")),r=d(a("lSNA")),s=d(a("QILm")),i=d(a("q1tI")),u=d(a("TSYQ")),o=d(a("7Zm1")),c=function(e){var t,a=e.colorful,d=void 0===a||a,c=e.reverseColor,f=void 0!==c&&c,m=e.flag,y=e.children,h=e.className,g=(0,s.default)(e,["colorful","reverseColor","flag","children","className"]),p=(0,u.default)(o.default.trendItem,(t={},(0,r.default)(t,o.default.trendItemGrey,!d),(0,r.default)(t,o.default.reverseColor,f&&d),t),h);return i.default.createElement("div",(0,l.default)({},g,{className:p,title:"string"===typeof y?y:""}),i.default.createElement("span",{className:o.default.value},y),m&&i.default.createElement("span",{className:o.default[m]},i.default.createElement(n.default,{type:"caret-".concat(m)})))},f=c;t.default=f}}]);