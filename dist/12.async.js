(window["webpackJsonp"]=window["webpackJsonp"]||[]).push([[12],{"7Zm1":function(e,t,a){e.exports={trendItem:"antd-pro-components-trend-index-trendItem",down:"antd-pro-components-trend-index-down",up:"antd-pro-components-trend-index-up",trendItemGrey:"antd-pro-components-trend-index-trendItemGrey",reverseColor:"antd-pro-components-trend-index-reverseColor"}},E6K0:function(e,t,a){"use strict";var l=a("TqRt"),d=a("284h");Object.defineProperty(t,"__esModule",{value:!0}),t.default=void 0,a("IzEo");var n=l(a("bx4M"));a("14J3");var r=l(a("BMrR"));a("5Dmo");var s=l(a("3S7+"));a("Pwec");var i=l(a("CtXQ"));a("jCWc");var u=l(a("kPKH")),o=l(a("MVZn")),c=l(a("lwsE")),f=l(a("W8MJ")),m=l(a("a1gu")),h=l(a("Nsbk")),p=l(a("7W2i"));a("Znn+");var y=l(a("ZTPi"));a("iQDF");var g=l(a("+eQT"));a("OaEy");var v=l(a("2fM7")),R=d(a("q1tI")),E=a("MuoO"),k=a("LLXN"),C=a("34ay"),b=l(a("ZhIB")),M=(l(a("4IMT")),a("KTCi")),I=l(a("v99g")),x=a("+n12"),D=l(a("YR7N")),A=l(a("rBGm")),B=(a("eHHv"),a("PQp+"),a("1pet"),a("+n12"),l(a("wd/R")));a("f0Wu");l(a("fqRC")),v.default.Option;var T,P,w=g.default.RangePicker,N={xs:24,sm:12,md:12,lg:12,xl:6,style:{marginBottom:24}},S=(0,C.getAuthority)(),F=y.default.TabPane,W=(T=(0,E.connect)(function(e){var t=e.areas,a=e.dashboard,l=(e.geo,e.loading);e.chart;return{dashboard:a,selectedAreaId:t.selectedAreaId,areaNames:t.areaNames,barChartloading:l.models.areas||l.effects["dashboard/fetchRideCount"]||l.effects["dashboard/fetchCustomerCount"],activeRideCountLoading:l.models.areas||l.effects["dashboard/fetchDailyRideCounts"],weeklyBatteryStateLoading:l.models.areas||l.effects["dashboard/fetchWeeklyBatteryState"],currentActiveRideLoading:l.models.areas||l.effects["dashboard/fetchDailyRideCounts"],weeklyBatterySwapLoading:l.models.areas||l.effects["dashboard/fetchWeeklyBatteryState"],stripeRevenueLoading:l.models.areas||l.effects["dashboard/fetchStripeDailyRevenue"],dailyRideRevenueLoading:l.models.areas||l.effects["dashboard/fetchDailyRideRevenue"],totalAreaMinutesLoading:l.models.areas||l.effects["dashboard/areaTotalMinutes"],totalAreaDistanceLoading:l.models.areas||l.effects["dashboard/areaTotalDistance"]}}),T(P=function(e){function t(e){var a;return(0,c.default)(this,t),a=(0,m.default)(this,(0,h.default)(t).call(this,e)),a.state={rangePickerValue:(0,x.getTimeDistance)("month"),offset:(new Date).getTimezoneOffset()/-60+1,countParams:{period:"month"}},a.setClickedMarker=function(e){a.setState({selectedMarker:e})},a.selectDate=function(e){a.props.dispatch;a.setState({countParams:(0,o.default)({},a.state.rideCountParams,{period:e}),rangePickerValue:(0,x.getTimeDistance)(e)},a.loadBarCharData)},a.handleRangePickerChange=function(e){a.props.dispatch;a.setState({rangePickerValue:e},a.loadBarCharData)},a.getRankingBoard=function(){var e=a.props,t=e.dashboard,l=e.areaNames;return S.includes("get.ride.vehicle.rank")&&R.default.createElement(u.default,{xl:8,lg:12,md:12,sm:24,xs:24},R.default.createElement("div",{className:A.default.salesRank},R.default.createElement("h4",{className:A.default.rankingTitle},R.default.createElement(k.FormattedMessage,{id:"app.dashboard.rides-ranking",defaultMessage:"Rides Ranking"})),R.default.createElement("ul",{className:A.default.rankingList,style:{height:200,marginBottom:"20px",overflow:"scroll"}},t.ridePerVehicleRank.map(function(e,t){return R.default.createElement("li",{key:e.areaId},R.default.createElement("span",{className:"".concat(A.default.rankingItemNumber," ").concat(t<3?A.default.active:"")},t+1),R.default.createElement("span",{className:A.default.rankingItemTitle,title:l[e.areaId]},l[e.areaId]),R.default.createElement("span",{className:A.default.rankingItemValue},(0,b.default)(e.avgRides).format("0,0.00")))}))))},a}return(0,p.default)(t,e),(0,f.default)(t,[{key:"componentDidMount",value:function(){var e=this;this.props.selectedAreaId,this.props.dispatch;this.reqRef=requestAnimationFrame(function(){e.loadBarCharData(),e.loadDailyRideCount(),e.loadWeeklyBatteryStatus(),e.loadStripeRevenue(),e.loadDailyRideRevenue(),e.timeoutId=setTimeout(function(){e.setState({loading:!1})},2e3),e.pollingId=setInterval(function(){e.loadDailyRideCount(),e.loadWeeklyBatteryStatus(),e.loadDailyRideRevenue(),e.loadStripeRevenue(),e.setState({areaIsChanged:!1})},3e4)})}},{key:"componentWillUnmount",value:function(){var e=this.props.dispatch;e({type:"dashboard/clear"}),cancelAnimationFrame(this.reqRef),clearTimeout(this.timeoutId),clearInterval(this.pollingId)}},{key:"fetchTotalRideRevenue",value:function(){var e=this.props,t=e.dispatch,a=e.selectedAreaId,l=this.state.rangePickerValue;S.includes("get.total.ride.revenue")&&t({type:"dashboard/fetchTotalRideRevenue",params:{areaId:a,start:l[0].unix(),end:l[1].unix()}})}},{key:"fetchTotalRefund",value:function(){var e=this.props,t=e.dispatch,a=e.selectedAreaId,l=this.state.rangePickerValue;S.includes("get.total.refund")&&t({type:"dashboard/fetchTotalRefund",params:{areaId:a,start:l[0].unix(),end:l[1].unix()}})}},{key:"loadBarCharData",value:function(){this.fetchRideCount(),this.fetchCustomerCount(),this.getStripeRevenueByPeriod(),this.fetchRidePerVehicleRank(),this.getConnectivityByPeriod(),this.fetchTotalRefund(),this.fetchTotalRideRevenue(),null!==this.props.selectedAreaId&&(this.fetchAreaDistance(),this.fetchAreaMinutes())}},{key:"clearMinutesAndDistance",value:function(){var e=this.props.dispatch;e({type:"dashboard/clearMinutesAndDistance"})}},{key:"loadDailyRideCount",value:function(){var e=this.props,t=e.dispatch,a=e.selectedAreaId;S.includes("get.daily.ride.count")&&t({type:"dashboard/fetchDailyRideCounts",params:{areaId:a,midnight:(0,B.default)().tz("America/Chicago").startOf("day").unix()}})}},{key:"loadRideDailyRevenue",value:function(){var e=this.props,t=e.dispatch,a=e.selectedAreaId;S.includes("get.daily.ride.revenue")&&t({type:"dashboard/fetchDailyRideRevenue",params:{areaId:a,midnight:(0,B.default)().tz("America/Chicago").startOf("day").unix()}})}},{key:"loadStripeRevenue",value:function(){var e=this.props,t=e.dispatch,a=e.selectedAreaId;S.includes("get.stripe.revenue")&&t({type:"dashboard/fetchStripeDailyRevenue",params:{areaId:a,midnight:(0,B.default)().tz("America/Chicago").startOf("day").unix()}})}},{key:"loadDailyRideRevenue",value:function(){var e=this.props,t=e.dispatch,a=e.selectedAreaId;S.includes("get.daily.ride.revenue")&&t({type:"dashboard/fetchDailyRideRevenue",params:{areaId:a,midnight:(0,B.default)().tz("America/Chicago").startOf("day").unix()}})}},{key:"loadWeeklyBatteryStatus",value:function(){var e=this.props,t=e.dispatch,a=e.selectedAreaId,l=this.state.offset;S.includes("get.weekly.battery.state")&&t({type:"dashboard/fetchWeeklyBatteryState",params:{areaId:a,midnight:(0,B.default)().subtract(7,"d").unix(),offset:l}})}},{key:"getRangeEnd",value:function(e){var t=(0,B.default)();return e.diff(t,"seconds")>0?t:e}},{key:"fetchRideCount",value:function(){var e=this.props,t=e.dispatch,a=e.selectedAreaId,l=this.state,d=l.countParams,n=l.offset,r=l.rangePickerValue;S.includes("get.ride.count")&&t({type:"dashboard/fetchRideCount",params:Object.assign({},d,{offset:n,areaId:a,start:r[0].unix(),end:r[1].unix()})})}},{key:"fetchCustomerCount",value:function(){var e=this.props,t=e.dispatch,a=e.selectedAreaId,l=this.state,d=l.countParams,n=l.offset,r=l.rangePickerValue;S.includes("get.customer.count")&&t({type:"dashboard/fetchCustomerCount",params:Object.assign({},d,{offset:n,areaId:a,start:r[0].unix(),end:r[1].unix()})})}},{key:"getStripeRevenueByPeriod",value:function(){var e=this.props,t=e.dispatch,a=e.selectedAreaId,l=this.state,d=l.countParams,n=l.offset,r=l.rangePickerValue;S.includes("get.stripe.revenue.by.period")&&t({type:"dashboard/fetchStripRevenueByPeriod",params:Object.assign({},d,{offset:n,areaId:a||-1,start:r[0].unix(),end:r[1].unix()})})}},{key:"getConnectivityByPeriod",value:function(){var e=this.props,t=e.dispatch,a=e.selectedAreaId,l=this.state,d=l.countParams,n=l.offset,r=l.rangePickerValue;S.includes("get.connectivity.by.period")&&t({type:"dashboard/fetchConnectivityByPeriod",params:Object.assign({},d,{offset:n,areaId:a||-1,start:r[0].unix(),end:r[1].unix()})})}},{key:"fetchAreaMinutes",value:function(){var e=this.props,t=e.dispatch,a=e.selectedAreaId,l=this.state.rangePickerValue;S.includes("get.area.minutes")&&t({type:"dashboard/fetchAreaMinutes",params:Object.assign({},{areaId:a,start:1e3*l[0].unix(),end:1e3*l[1].unix()})})}},{key:"fetchAreaDistance",value:function(){var e=this.props,t=e.dispatch,a=e.selectedAreaId,l=this.state.rangePickerValue;S.includes("get.area.distance")&&t({type:"dashboard/fetchAreaDistance",params:Object.assign({},{areaId:a,start:1e3*l[0].unix(),end:1e3*l[1].unix()})})}},{key:"fetchRidePerVehicleRank",value:function(){var e=this.props,t=e.dispatch,a=(e.selectedAreaId,this.state),l=a.rangePickerValue,d=a.offset;S.includes("get.ride.vehicle.rank")&&t({type:"dashboard/getRidePerVehicleRank",params:Object.assign({},{start:l[0].unix(),end:l[1].unix(),offset:d})})}},{key:"componentDidUpdate",value:function(e,t,a){e.selectedAreaId!==this.props.selectedAreaId&&(this.loadBarCharData(),this.loadDailyRideCount(),this.loadWeeklyBatteryStatus(),this.loadDailyRideRevenue(),this.loadStripeRevenue(),this.setState({areaIsChanged:!0}),null===this.props.selectedAreaId&&this.clearMinutesAndDistance())}},{key:"isActive",value:function(e){var t=this.state.rangePickerValue,a=(0,x.getTimeDistance)(e);return t[0]&&t[1]&&t[0].isSame(a[0],"day")&&t[1].isSame(a[1],"day")?A.default.currentDate:""}},{key:"render",value:function(){var e=this,t=this.props,a=(t.selectedAreaId,t.geo,t.areaNames,t.barChartloading),l=t.activeRideCountLoading,d=t.dashboard,o=t.stripeRevenueLoading,c=(t.currentActiveRideLoading,t.weeklyBatterySwapLoading),f=t.dailyRideRevenueLoading,m=this.state,h=m.rangePickerValue,p=(m.areaIsChanged,R.default.createElement("div",{className:A.default.salesExtraWrap},R.default.createElement("div",{className:A.default.salesExtra},R.default.createElement("a",{className:this.isActive("day"),onClick:function(){return e.selectDate("day")}},R.default.createElement(k.FormattedMessage,{id:"app.analysis.all-day",defaultMessage:"All Day"})),R.default.createElement("a",{className:this.isActive("week"),onClick:function(){return e.selectDate("week")}},R.default.createElement(k.FormattedMessage,{id:"app.analysis.all-week",defaultMessage:"All Week"})),R.default.createElement("a",{className:this.isActive("month"),onClick:function(){return e.selectDate("month")}},R.default.createElement(k.FormattedMessage,{id:"app.analysis.all-month",defaultMessage:"All Month"})),R.default.createElement("a",{className:this.isActive("year"),onClick:function(){return e.selectDate("year")}},R.default.createElement(k.FormattedMessage,{id:"app.analysis.all-year",defaultMessage:"All Year"}))),R.default.createElement(w,{value:h,onChange:this.handleRangePickerChange,style:{width:256}}))),g=function(e){return e>0?Math.round(100*e)/100:e},v=function(e){return null===e||void 0===e?null:e.toFixed(2)},E=function(t){var a=e.state.countParams;if(void 0===t||0===t.length||"day"!==a.period||isNaN(t[0].x))return t;var l=t.sort(function(e,t){var a=parseInt(e.x,10),l=parseInt(t.x,10);return a-l}).map(function(e){var a=parseInt(e.x),l=(a-1)%12+(a<12?"AM":"PM");return e.temp=l,e.x=l,t.length<20&&console.log(e),e});return console.log(l),l},C=this.getRangeEnd(h[1]).diff(h[0],"days");0===C&&(C=1);var x=d.dailyRideCount,T=d.batteryState,P=d.stripeRevenue,W=d.dailyRideRevenue,V=d.totalRideMinutes,L=d.totalRideDistance,O=T.weeklyBatterySwap&&T.weeklyBatterySwap.map(function(e){return{x:(0,B.default)().dayOfYear(e.dayOfYear).format("MM/DD"),y:e.total}});return R.default.createElement(I.default,null,R.default.createElement(r.default,{gutter:24,style:{marginTop:"2em"}},S.includes("get.daily.ride.count")&&R.default.createElement(u.default,N,R.default.createElement(M.ChartCard,{bordered:!1,title:"Current Active Rides",action:R.default.createElement(s.default,{title:"introduce"},R.default.createElement(i.default,{type:"info-circle-o"})),total:l?"loading":x.currentActiveRideCount,footer:R.default.createElement(M.Field,{label:"Total Ride Today",value:l?"loading":"".concat(x.todayRideCount)}),contentHeight:60},R.default.createElement(D.default,{flag:x.todayRideCount-x.lastWeekRideCount>0?"up":"down",style:{marginRight:16}},R.default.createElement(k.FormattedMessage,{id:"app.analysis.week",defaultMessage:"Weekly Changes"}),R.default.createElement("span",{className:A.default.trendText}," ",Math.round((x.todayRideCount-x.lastWeekRideCount)/x.lastWeekRideCount*100),"%")),R.default.createElement(D.default,{flag:x.todayRideCount-x.yesterdayRideCount>0?"up":"down"},R.default.createElement(k.FormattedMessage,{id:"app.analysis.day",defaultMessage:"Daily Changes"}),R.default.createElement("span",{className:A.default.trendText},Math.round((x.todayRideCount-x.yesterdayRideCount)/x.yesterdayRideCount*100),"%")))),S.includes("get.weekly.battery.state")&&O&&R.default.createElement(u.default,N,R.default.createElement(M.ChartCard,{bordered:!1,loading:!1,title:"Total Battery Swap Today",action:R.default.createElement(s.default,{title:R.default.createElement(k.FormattedMessage,{id:"app.analysis.introduce",defaultMessage:"introduce"})},R.default.createElement(i.default,{type:"info-circle-o"})),total:c?"loading":O[O.length-1]&&(0,b.default)(O[O.length-1].y).format("0,0"),footer:R.default.createElement(M.Field,{label:"Low Battery Vehicles",value:c?"loading":(0,b.default)(T.lowBatteryCount).format("0,0")}),contentHeight:60},R.default.createElement(M.MiniBar,{color:"#975FE4",data:O}))),S.includes("get.stripe.revenue")&&P&&R.default.createElement(u.default,N,R.default.createElement(M.ChartCard,{bordered:!1,title:"Today's Stripe Revenue",action:R.default.createElement(s.default,{title:"introduce"},R.default.createElement(i.default,{type:"info-circle-o"})),loading:o,total:o?"loading":P.dailyRevenue/100,footer:R.default.createElement(M.Field,{label:"Total Revenue",value:o?"loading":"".concat(P.totalRevenue/100)}),contentHeight:60},R.default.createElement(D.default,{flag:P.dailyRevenue-P.lastWeekRevenue>0?"up":"down",style:{marginRight:16}},R.default.createElement(k.FormattedMessage,{id:"app.analysis.week",defaultMessage:"Weekly Changes"}),R.default.createElement("span",{className:A.default.trendText}," ",o?"loading":Math.round((P.dailyRevenue-P.lastWeekRevenue)/P.lastWeekRevenue*100),"%")),R.default.createElement(D.default,{flag:P.dailyRevenue-P.yesterdayRevenue>0?"up":"down"},R.default.createElement(k.FormattedMessage,{id:"app.analysis.day",defaultMessage:"Daily Changes"}),R.default.createElement("span",{className:A.default.trendText},o?"loading":Math.round((P.dailyRevenue-P.yesterdayRevenue)/P.yesterdayRevenue*100),"%")))),S.includes("get.daily.ride.revenue")&&W&&R.default.createElement(u.default,N,R.default.createElement(M.ChartCard,{bordered:!1,title:"Today's Ride Revenue",action:R.default.createElement(s.default,{title:"introduce"},R.default.createElement(i.default,{type:"info-circle-o"})),loading:f,total:f?"loading":W.dailyRevenue,footer:R.default.createElement(M.Field,{label:"Total Revenue",value:"".concat(W.totalRevenue)}),contentHeight:60},R.default.createElement(D.default,{flag:W.dailyRevenue-W.lastWeekRevenue>0?"up":"down",style:{marginRight:16}},R.default.createElement(k.FormattedMessage,{id:"app.analysis.week",defaultMessage:"Weekly Changes"}),R.default.createElement("span",{className:A.default.trendText}," ",Math.round((W.dailyRevenue-W.lastWeekRevenue)/W.lastWeekRevenue*100),"%")),R.default.createElement(D.default,{flag:W.dailyRevenue-W.yesterdayRevenue>0?"up":"down"},R.default.createElement(k.FormattedMessage,{id:"app.analysis.day",defaultMessage:"Daily Changes"}),R.default.createElement("span",{className:A.default.trendText},Math.round((W.dailyRevenue-W.yesterdayRevenue)/W.yesterdayRevenue*100),"%"))))),(S.includes("get.ride.count")||S.includes("get.ride.count"))&&R.default.createElement(n.default,{loading:a,bordered:!1,bodyStyle:{padding:0}},R.default.createElement("div",{className:A.default.salesCard},R.default.createElement(y.default,{tabBarExtraContent:p,size:"large",tabBarStyle:{marginBottom:24}},S.includes("get.ride.count")&&R.default.createElement(F,{tab:R.default.createElement(k.FormattedMessage,{id:"app.analysis.sales",defaultMessage:"Sales"}),key:"rides"},R.default.createElement(r.default,null,R.default.createElement(u.default,{xl:16,lg:12,md:12,sm:24,xs:24},R.default.createElement("div",{className:A.default.salesBar},R.default.createElement(M.Bar,{height:295,title:R.default.createElement(k.FormattedMessage,{id:"app.dashboard.rides-trend",defaultMessage:"Rides Trend"}),data:E(d.rideCountData)}))),this.getRankingBoard())),S.includes("get.ride.count")&&R.default.createElement(F,{tab:R.default.createElement(k.FormattedMessage,{id:"app.dashboard.customers",defaultMessage:"Customers"}),key:"customers"},R.default.createElement(r.default,null,R.default.createElement(u.default,{xl:16,lg:12,md:12,sm:24,xs:24},R.default.createElement("div",{className:A.default.salesBar},R.default.createElement(M.Bar,{height:292,title:R.default.createElement(k.FormattedMessage,{id:"app.dashboard.customers-trend",defaultMessage:"Customer Trend"}),data:E(d.customerCountData)}))),this.getRankingBoard())),S.includes("get.stripe.revenue.by.period")&&R.default.createElement(F,{tab:"Stripe Revenue",key:"revenue"},R.default.createElement(r.default,null,R.default.createElement(u.default,{xl:16,lg:12,md:12,sm:24,xs:24},R.default.createElement("div",{className:A.default.salesBar},R.default.createElement(M.Bar,{height:292,title:"Revenue Trend",data:E(d.stripeRevenueData)}))),this.getRankingBoard())),S.includes("get.connectivity.by.period")&&R.default.createElement(F,{tab:"Vehicle Connectivity",key:"connectivity"},R.default.createElement(r.default,null,R.default.createElement(u.default,{xl:16,lg:12,md:12,sm:24,xs:24},R.default.createElement("div",{className:A.default.salesBar},R.default.createElement(M.Bar,{height:292,title:"Connectivity Trend",data:E(d.connectivity)}))),this.getRankingBoard())),S.includes("get.total.refund")&&S.includes("get.total.ride.revenue")&&R.default.createElement(F,{tab:"Finace Report",key:"financeStats"},R.default.createElement(r.default,null,R.default.createElement(u.default,{xl:16,lg:12,md:12,sm:24,xs:24},R.default.createElement("div",{style:{marginLeft:"1em"}},"  Total Ride Revenue: ",g(d.totalRideRevenue)," "),R.default.createElement("div",{style:{marginLeft:"1em"}}," Total Refund to Card: ",g(d.totalRefund.refundToCard)," "),R.default.createElement("div",{style:{marginLeft:"1em"}}," Total Refund to Deposit: ",g(d.totalRefund.refundToDeposit)," ")),this.getRankingBoard())),S.includes("get.area.minutes")&&null!==this.props.selectedAreaId&&R.default.createElement(F,{tab:"Ride Metrics",key:"metrics"},R.default.createElement(r.default,null,R.default.createElement(u.default,{xl:16,lg:12,md:12,sm:24,xs:24},R.default.createElement("div",{className:A.default.salesBar},R.default.createElement("span",null,R.default.createElement("h2",null,"Total Ride Distance (miles)"),R.default.createElement("h3",null,v(L.totalDistance))),R.default.createElement("span",null,R.default.createElement("h2",null,"Total Ride Time (minutes)"),R.default.createElement("h3",null,V.totalMinutes)))),this.getRankingBoard()))))))}}]),t}(R.Component))||P),V=W;t.default=V},YR7N:function(e,t,a){"use strict";var l=a("TqRt");Object.defineProperty(t,"__esModule",{value:!0}),t.default=void 0;var d=l(a("pVnL"));a("Pwec");var n=l(a("CtXQ")),r=l(a("lSNA")),s=l(a("QILm")),i=l(a("q1tI")),u=l(a("TSYQ")),o=l(a("7Zm1")),c=function(e){var t,a=e.colorful,l=void 0===a||a,c=e.reverseColor,f=void 0!==c&&c,m=e.flag,h=e.children,p=e.className,y=(0,s.default)(e,["colorful","reverseColor","flag","children","className"]),g=(0,u.default)(o.default.trendItem,(t={},(0,r.default)(t,o.default.trendItemGrey,!l),(0,r.default)(t,o.default.reverseColor,f&&l),t),p);return i.default.createElement("div",(0,d.default)({},y,{className:g,title:"string"===typeof h?h:""}),i.default.createElement("span",{className:o.default.value},h),m&&i.default.createElement("span",{className:o.default[m]},i.default.createElement(n.default,{type:"caret-".concat(m)})))},f=c;t.default=f}}]);