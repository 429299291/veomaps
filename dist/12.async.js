(window["webpackJsonp"]=window["webpackJsonp"]||[]).push([[12],{"7Zm1":function(e,t,a){e.exports={trendItem:"antd-pro-components-trend-index-trendItem",down:"antd-pro-components-trend-index-down",up:"antd-pro-components-trend-index-up",trendItemGrey:"antd-pro-components-trend-index-trendItemGrey",reverseColor:"antd-pro-components-trend-index-reverseColor"}},E6K0:function(e,t,a){"use strict";var d=a("TqRt"),l=a("284h");Object.defineProperty(t,"__esModule",{value:!0}),t.default=void 0,a("IzEo");var n=d(a("bx4M"));a("14J3");var r=d(a("BMrR"));a("5Dmo");var s=d(a("3S7+"));a("Pwec");var i=d(a("CtXQ"));a("jCWc");var u=d(a("kPKH")),o=d(a("MVZn")),c=d(a("lwsE")),f=d(a("W8MJ")),m=d(a("a1gu")),y=d(a("Nsbk")),g=d(a("7W2i"));a("Znn+");var h=d(a("ZTPi"));a("iQDF");var p=d(a("+eQT"));a("OaEy");var v,R,E=d(a("2fM7")),k=l(a("q1tI")),C=a("MuoO"),b=a("LLXN"),M=a("34ay"),I=d(a("ZhIB")),B=(d(a("4IMT")),a("KTCi")),x=d(a("v99g")),D=a("+n12"),w=d(a("YR7N")),N=d(a("rBGm")),P=(a("eHHv"),a("PQp+"),a("1pet"),a("+n12"),d(a("wd/R"))),S=(d(a("fqRC")),E.default.Option,p.default.RangePicker),T={xs:24,sm:12,md:12,lg:12,xl:6,style:{marginBottom:24}},A=(0,M.getAuthority)(),F=h.default.TabPane,W=(v=(0,C.connect)(function(e){var t=e.areas,a=e.dashboard,d=(e.geo,e.loading);e.chart;return{dashboard:a,selectedAreaId:t.selectedAreaId,areaNames:t.areaNames,barChartloading:d.models.areas||d.effects["dashboard/fetchRideCount"]||d.effects["dashboard/fetchCustomerCount"],activeRideCountLoading:d.models.areas||d.effects["dashboard/fetchDailyRideCounts"],weeklyBatteryStateLoading:d.models.areas||d.effects["dashboard/fetchWeeklyBatteryState"],revenueLoading:d.models.areas||d.effects["dashboard/fetchStripeDailyRevenue"],currentActiveRideLoading:d.models.areas||d.effects["dashboard/fetchDailyRideCounts"],weeklyBatterySwapLoading:d.models.areas||d.effects["dashboard/fetchDailyRideCounts"],dailyRideRevenueLoading:d.models.areas||d.effects["dashboard/fetchDailyRideRevenue"]}}),v(R=function(e){function t(e){var a;return(0,c.default)(this,t),a=(0,m.default)(this,(0,y.default)(t).call(this,e)),a.state={rangePickerValue:(0,D.getTimeDistance)("month"),offset:(new Date).getTimezoneOffset()/-60+1,countParams:{period:"month"}},a.setClickedMarker=function(e){a.setState({selectedMarker:e})},a.selectDate=function(e){a.props.dispatch;a.setState({countParams:(0,o.default)({},a.state.rideCountParams,{period:e}),rangePickerValue:(0,D.getTimeDistance)(e)},a.loadBarCharData)},a.handleRangePickerChange=function(e){a.props.dispatch;a.setState({rangePickerValue:e},a.loadBarCharData)},a.getRankingBoard=function(){var e=a.props,t=e.dashboard,d=e.areaNames;return A.includes("get.ride.vehicle.rank")&&k.default.createElement(u.default,{xl:8,lg:12,md:12,sm:24,xs:24},k.default.createElement("div",{className:N.default.salesRank},k.default.createElement("h4",{className:N.default.rankingTitle},k.default.createElement(b.FormattedMessage,{id:"app.dashboard.rides-ranking",defaultMessage:"Rides Ranking"})),k.default.createElement("ul",{className:N.default.rankingList,style:{height:200,marginBottom:"20px",overflow:"scroll"}},t.ridePerVehicleRank.map(function(e,t){return k.default.createElement("li",{key:e.areaId},k.default.createElement("span",{className:"".concat(N.default.rankingItemNumber," ").concat(t<3?N.default.active:"")},t+1),k.default.createElement("span",{className:N.default.rankingItemTitle,title:d[e.areaId]},d[e.areaId]),k.default.createElement("span",{className:N.default.rankingItemValue},(0,I.default)(e.avgRides).format("0,0.00")))}))))},a}return(0,g.default)(t,e),(0,f.default)(t,[{key:"componentDidMount",value:function(){var e=this;this.props.selectedAreaId,this.props.dispatch;this.reqRef=requestAnimationFrame(function(){e.loadBarCharData(),e.loadDailyRideCount(),e.loadWeeklyBatteryStatus(),e.loadStripeRevenue(),e.loadDailyRideRevenue(),e.timeoutId=setTimeout(function(){e.setState({loading:!1})},600),e.pollingId=setInterval(function(){e.loadDailyRideCount(),e.loadWeeklyBatteryStatus(),e.loadDailyRideRevenue(),e.setState({areaIsChanged:!1})},1e4)})}},{key:"componentWillUnmount",value:function(){var e=this.props.dispatch;e({type:"dashboard/clear"}),cancelAnimationFrame(this.reqRef),clearTimeout(this.timeoutId),clearInterval(this.pollingId)}},{key:"loadBarCharData",value:function(){this.fetchRideCount(),this.fetchCustomerCount(),this.getStripeRevenueByPeriod(),this.fetchRidePerVehicleRank(),this.getConnectivityByPeriod()}},{key:"loadDailyRideCount",value:function(){var e=this.props,t=e.dispatch,a=e.selectedAreaId;A.includes("get.daily.ride.count")&&t({type:"dashboard/fetchDailyRideCounts",params:{areaId:a,midnight:(0,P.default)().startOf("day").unix()}})}},{key:"loadRideDailyRevenue",value:function(){var e=this.props,t=e.dispatch,a=e.selectedAreaId;A.includes("get.daily.ride.revenue")&&t({type:"dashboard/fetchDailyRideRevenue",params:{areaId:a,midnight:(0,P.default)().startOf("day").unix()}})}},{key:"loadStripeRevenue",value:function(){var e=this.props,t=e.dispatch,a=e.selectedAreaId;A.includes("get.stripe.revenue")&&t({type:"dashboard/fetchStripeDailyRevenue",params:{areaId:a,midnight:(0,P.default)().startOf("day").unix()}})}},{key:"loadDailyRideRevenue",value:function(){var e=this.props,t=e.dispatch,a=e.selectedAreaId;A.includes("get.daily.ride.revenue")&&t({type:"dashboard/fetchDailyRideRevenue",params:{areaId:a,midnight:(0,P.default)().startOf("day").unix()}})}},{key:"loadWeeklyBatteryStatus",value:function(){var e=this.props,t=e.dispatch,a=e.selectedAreaId,d=this.state.offset;A.includes("get.weekly.battery.state")&&t({type:"dashboard/fetchWeeklyBatteryState",params:{areaId:a,midnight:(0,P.default)().subtract(7,"d").unix(),offset:d}})}},{key:"getRangeEnd",value:function(e){var t=(0,P.default)();return e.diff(t,"seconds")>0?t:e}},{key:"fetchRideCount",value:function(){var e=this.props,t=e.dispatch,a=e.selectedAreaId,d=this.state,l=d.countParams,n=d.offset,r=d.rangePickerValue;A.includes("get.ride.count")&&t({type:"dashboard/fetchRideCount",params:Object.assign({},l,{offset:n,areaId:a,start:r[0].unix(),end:r[1].unix()})})}},{key:"fetchCustomerCount",value:function(){var e=this.props,t=e.dispatch,a=e.selectedAreaId,d=this.state,l=d.countParams,n=d.offset,r=d.rangePickerValue;A.includes("get.customer.count")&&t({type:"dashboard/fetchCustomerCount",params:Object.assign({},l,{offset:n,areaId:a,start:r[0].unix(),end:r[1].unix()})})}},{key:"getStripeRevenueByPeriod",value:function(){var e=this.props,t=e.dispatch,a=e.selectedAreaId,d=this.state,l=d.countParams,n=d.offset,r=d.rangePickerValue;A.includes("get.stripe.revenue.by.period")&&t({type:"dashboard/fetchStripRevenueByPeriod",params:Object.assign({},l,{offset:n,areaId:a||-1,start:r[0].unix(),end:r[1].unix()})})}},{key:"getConnectivityByPeriod",value:function(){var e=this.props,t=e.dispatch,a=e.selectedAreaId,d=this.state,l=d.countParams,n=d.offset,r=d.rangePickerValue;A.includes("get.connectivity.by.period")&&t({type:"dashboard/fetchConnectivityByPeriod",params:Object.assign({},l,{offset:n,areaId:a||-1,start:r[0].unix(),end:r[1].unix()})})}},{key:"fetchRidePerVehicleRank",value:function(){var e=this.props,t=e.dispatch,a=(e.selectedAreaId,this.state),d=a.rangePickerValue,l=a.offset;A.includes("get.ride.vehicle.rank")&&t({type:"dashboard/getRidePerVehicleRank",params:Object.assign({},{start:d[0].unix(),end:d[1].unix(),offset:l})})}},{key:"componentDidUpdate",value:function(e,t,a){e.selectedAreaId!==this.props.selectedAreaId&&(this.loadBarCharData(),this.loadDailyRideCount(),this.loadStripeRevenue(),this.setState({areaIsChanged:!0}))}},{key:"isActive",value:function(e){var t=this.state.rangePickerValue,a=(0,D.getTimeDistance)(e);return t[0]&&t[1]&&t[0].isSame(a[0],"day")&&t[1].isSame(a[1],"day")?N.default.currentDate:""}},{key:"render",value:function(){var e=this,t=this.props,a=(t.selectedAreaId,t.geo,t.areaNames,t.barChartloading),d=(t.activeRideCountLoading,t.dashboard),l=t.revenueLoading,o=(t.currentActiveRideLoading,t.weeklyBatterySwapLoading,t.dailyRideRevenueLoading,this.state),c=o.rangePickerValue,f=o.areaIsChanged,m=k.default.createElement("div",{className:N.default.salesExtraWrap},k.default.createElement("div",{className:N.default.salesExtra},k.default.createElement("a",{className:this.isActive("day"),onClick:function(){return e.selectDate("day")}},k.default.createElement(b.FormattedMessage,{id:"app.analysis.all-day",defaultMessage:"All Day"})),k.default.createElement("a",{className:this.isActive("week"),onClick:function(){return e.selectDate("week")}},k.default.createElement(b.FormattedMessage,{id:"app.analysis.all-week",defaultMessage:"All Week"})),k.default.createElement("a",{className:this.isActive("month"),onClick:function(){return e.selectDate("month")}},k.default.createElement(b.FormattedMessage,{id:"app.analysis.all-month",defaultMessage:"All Month"})),k.default.createElement("a",{className:this.isActive("year"),onClick:function(){return e.selectDate("year")}},k.default.createElement(b.FormattedMessage,{id:"app.analysis.all-year",defaultMessage:"All Year"}))),k.default.createElement(S,{value:c,onChange:this.handleRangePickerChange,style:{width:256}})),y=this.getRangeEnd(c[1]).diff(c[0],"days");0===y&&(y=1);var g=d.dailyRideCount,p=d.batteryState,v=d.stripeRevenue,R=d.dailyRideRevenue,E=p.weeklyBatterySwap&&p.weeklyBatterySwap.map(function(e){return{x:(0,P.default)().dayOfYear(e.dayOfYear).format("MM/DD"),y:e.total}});return k.default.createElement(x.default,null,k.default.createElement(r.default,{gutter:24,style:{marginTop:"2em"}},A.includes("get.daily.ride.count")&&k.default.createElement(u.default,T,k.default.createElement(B.ChartCard,{bordered:!1,title:"Current Active Rides",action:k.default.createElement(s.default,{title:"introduce"},k.default.createElement(i.default,{type:"info-circle-o"})),total:f?"loading":g.currentActiveRideCount,footer:k.default.createElement(B.Field,{label:"Total Ride Today",value:f?"loading":"".concat(g.todayRideCount)}),contentHeight:60},k.default.createElement(w.default,{flag:g.todayRideCount-g.lastWeekRideCount>0?"up":"down",style:{marginRight:16}},k.default.createElement(b.FormattedMessage,{id:"app.analysis.week",defaultMessage:"Weekly Changes"}),k.default.createElement("span",{className:N.default.trendText}," ",Math.round((g.todayRideCount-g.lastWeekRideCount)/g.lastWeekRideCount*100),"%")),k.default.createElement(w.default,{flag:g.todayRideCount-g.yesterdayRideCount>0?"up":"down"},k.default.createElement(b.FormattedMessage,{id:"app.analysis.day",defaultMessage:"Daily Changes"}),k.default.createElement("span",{className:N.default.trendText},Math.round((g.todayRideCount-g.yesterdayRideCount)/g.yesterdayRideCount*100),"%")))),A.includes("get.weekly.battery.state")&&E&&k.default.createElement(u.default,T,k.default.createElement(B.ChartCard,{bordered:!1,loading:!1,title:"Total Battery Swap Today",action:k.default.createElement(s.default,{title:k.default.createElement(b.FormattedMessage,{id:"app.analysis.introduce",defaultMessage:"introduce"})},k.default.createElement(i.default,{type:"info-circle-o"})),total:f?"loading":E[E.length-1]&&(0,I.default)(E[E.length-1].y).format("0,0"),footer:k.default.createElement(B.Field,{label:"Low Battery Vehicles",value:f?"loading":(0,I.default)(p.lowBatteryCount).format("0,0")}),contentHeight:60},k.default.createElement(B.MiniBar,{color:"#975FE4",data:E}))),A.includes("get.stripe.revenue")&&v&&k.default.createElement(u.default,T,k.default.createElement(B.ChartCard,{bordered:!1,title:"Today's Stripe Revenue",action:k.default.createElement(s.default,{title:"introduce"},k.default.createElement(i.default,{type:"info-circle-o"})),loading:!1,total:l?"loading":v.dailyRevenue/100,footer:k.default.createElement(B.Field,{label:"Total Revenue",value:l?"loading":"".concat(v.totalRevenue/100)}),contentHeight:60},k.default.createElement(w.default,{flag:v.dailyRevenue-v.lastWeekRevenue>0?"up":"down",style:{marginRight:16}},k.default.createElement(b.FormattedMessage,{id:"app.analysis.week",defaultMessage:"Weekly Changes"}),k.default.createElement("span",{className:N.default.trendText}," ",l?"loading":Math.round((v.dailyRevenue-v.lastWeekRevenue)/v.lastWeekRevenue*100),"%")),k.default.createElement(w.default,{flag:v.dailyRevenue-v.yesterdayRevenue>0?"up":"down"},k.default.createElement(b.FormattedMessage,{id:"app.analysis.day",defaultMessage:"Daily Changes"}),k.default.createElement("span",{className:N.default.trendText},l?"loading":Math.round((v.dailyRevenue-v.yesterdayRevenue)/v.yesterdayRevenue*100),"%")))),A.includes("get.daily.ride.revenue")&&R&&k.default.createElement(u.default,T,k.default.createElement(B.ChartCard,{bordered:!1,title:"Today's Ride Revenue",action:k.default.createElement(s.default,{title:"introduce"},k.default.createElement(i.default,{type:"info-circle-o"})),loading:!1,total:f?"loading":R.dailyRevenue,footer:k.default.createElement(B.Field,{label:"Total Revenue",value:"".concat(R.totalRevenue)}),contentHeight:60},k.default.createElement(w.default,{flag:R.dailyRevenue-R.lastWeekRevenue>0?"up":"down",style:{marginRight:16}},k.default.createElement(b.FormattedMessage,{id:"app.analysis.week",defaultMessage:"Weekly Changes"}),k.default.createElement("span",{className:N.default.trendText}," ",Math.round((R.dailyRevenue-R.lastWeekRevenue)/R.lastWeekRevenue*100),"%")),k.default.createElement(w.default,{flag:R.dailyRevenue-R.yesterdayRevenue>0?"up":"down"},k.default.createElement(b.FormattedMessage,{id:"app.analysis.day",defaultMessage:"Daily Changes"}),k.default.createElement("span",{className:N.default.trendText},Math.round((R.dailyRevenue-R.yesterdayRevenue)/R.yesterdayRevenue*100),"%"))))),(A.includes("get.ride.count")||A.includes("get.ride.count"))&&k.default.createElement(n.default,{loading:a,bordered:!1,bodyStyle:{padding:0}},k.default.createElement("div",{className:N.default.salesCard},k.default.createElement(h.default,{tabBarExtraContent:m,size:"large",tabBarStyle:{marginBottom:24}},A.includes("get.ride.count")&&k.default.createElement(F,{tab:k.default.createElement(b.FormattedMessage,{id:"app.analysis.sales",defaultMessage:"Sales"}),key:"rides"},k.default.createElement(r.default,null,k.default.createElement(u.default,{xl:16,lg:12,md:12,sm:24,xs:24},k.default.createElement("div",{className:N.default.salesBar},k.default.createElement(B.Bar,{height:295,title:k.default.createElement(b.FormattedMessage,{id:"app.dashboard.rides-trend",defaultMessage:"Rides Trend"}),data:d.rideCountData}))),this.getRankingBoard())),A.includes("get.ride.count")&&k.default.createElement(F,{tab:k.default.createElement(b.FormattedMessage,{id:"app.dashboard.customers",defaultMessage:"Customers"}),key:"customers"},k.default.createElement(r.default,null,k.default.createElement(u.default,{xl:16,lg:12,md:12,sm:24,xs:24},k.default.createElement("div",{className:N.default.salesBar},k.default.createElement(B.Bar,{height:292,title:k.default.createElement(b.FormattedMessage,{id:"app.dashboard.customers-trend",defaultMessage:"Customer Trend"}),data:d.customerCountData}))),this.getRankingBoard())),A.includes("get.stripe.revenue.by.period")&&k.default.createElement(F,{tab:"Stripe Revenue",key:"revenue"},k.default.createElement(r.default,null,k.default.createElement(u.default,{xl:16,lg:12,md:12,sm:24,xs:24},k.default.createElement("div",{className:N.default.salesBar},k.default.createElement(B.Bar,{height:292,title:"Revenue Trend",data:d.stripeRevenueData}))),this.getRankingBoard())),A.includes("get.connectivity.by.period")&&k.default.createElement(F,{tab:"Vehicle Connectivity",key:"connectivity"},k.default.createElement(r.default,null,k.default.createElement(u.default,{xl:16,lg:12,md:12,sm:24,xs:24},k.default.createElement("div",{className:N.default.salesBar},k.default.createElement(B.Bar,{height:292,title:"Connectivity Trend",data:d.connectivity}))),this.getRankingBoard()))))))}}]),t}(k.Component))||R),V=W;t.default=V},YR7N:function(e,t,a){"use strict";var d=a("TqRt");Object.defineProperty(t,"__esModule",{value:!0}),t.default=void 0;var l=d(a("pVnL"));a("Pwec");var n=d(a("CtXQ")),r=d(a("lSNA")),s=d(a("QILm")),i=d(a("q1tI")),u=d(a("TSYQ")),o=d(a("7Zm1")),c=function(e){var t,a=e.colorful,d=void 0===a||a,c=e.reverseColor,f=void 0!==c&&c,m=e.flag,y=e.children,g=e.className,h=(0,s.default)(e,["colorful","reverseColor","flag","children","className"]),p=(0,u.default)(o.default.trendItem,(t={},(0,r.default)(t,o.default.trendItemGrey,!d),(0,r.default)(t,o.default.reverseColor,f&&d),t),g);return i.default.createElement("div",(0,l.default)({},h,{className:p,title:"string"===typeof y?y:""}),i.default.createElement("span",{className:o.default.value},y),m&&i.default.createElement("span",{className:o.default[m]},i.default.createElement(n.default,{type:"caret-".concat(m)})))},f=c;t.default=f}}]);