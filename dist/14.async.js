(window["webpackJsonp"]=window["webpackJsonp"]||[]).push([[14],{"67cV":function(e,t,a){"use strict";var l=a("284h"),r=a("TqRt");Object.defineProperty(t,"__esModule",{value:!0}),t.default=void 0,a("DjyN");var n=r(a("NUBc"));a("IzEo");var i=r(a("bx4M")),d=r(a("lwsE")),u=r(a("W8MJ")),c=r(a("a1gu")),o=r(a("Nsbk")),s=r(a("7W2i")),f=l(a("q1tI")),m=(r(a("s+Rv")),r(a("MLAF"))),p=function(e){function t(e){var a;(0,d.default)(this,t),a=(0,c.default)(this,(0,o.default)(t).call(this,e));e.vehicles;return a.state={expandItem:null},a}return(0,s.default)(t,e),(0,u.default)(t,[{key:"render",value:function(){var e=this.state,t=(e.selectedRowKeys,e.needTotalList,this.props),a=t.vehicles,l=t.getResponsiveVehicleInfo,r=t.selectedVehicleId,d=t.totalCount,u=t.onPageChange;t.selectedVehicleRefresh;return f.default.createElement("div",null,a.map(function(e){return f.default.createElement(i.default,{key:e.id,className:m.default.card},l(e,r))}),f.default.createElement(n.default,{style:{marginTop:"1em"},defaultCurrent:1,total:d,onChange:u}))}}]),t}(f.PureComponent),h=p;t.default=h},MLAF:function(e,t,a){e.exports={card:"antd-pro-pages-vehicle-responsive-list-card"}},"m1+7":function(e,t,a){e.exports={tableList:"antd-pro-pages-vehicle-vehicle-tableList",tableListOperator:"antd-pro-pages-vehicle-vehicle-tableListOperator",heatMapFilterMobile:"antd-pro-pages-vehicle-vehicle-heatMapFilterMobile",heatMapFilter:"antd-pro-pages-vehicle-vehicle-heatMapFilter",tableListForm:"antd-pro-pages-vehicle-vehicle-tableListForm",submitButtons:"antd-pro-pages-vehicle-vehicle-submitButtons"}},nAvq:function(e,t,a){"use strict";var l=a("TqRt"),r=a("284h");Object.defineProperty(t,"__esModule",{value:!0}),t.default=void 0;var n=l(a("pVnL"));a("IzEo");var i=l(a("bx4M"));a("giR+");var d=l(a("fyUT")),u=l(a("lSNA"));a("miYZ");var c=l(a("tsqr"));a("14J3");var o=l(a("BMrR"));a("Pwec");var s=l(a("CtXQ"));a("jCWc");var f=l(a("kPKH")),m=l(a("MVZn"));a("/zsF");var p=l(a("PArb")),h=l(a("lwsE")),v=l(a("W8MJ")),E=l(a("a1gu")),y=l(a("Nsbk")),g=l(a("7W2i"));a("2qtc");var b=l(a("kLXV"));a("T2oS");var S=l(a("W9HT"));a("+L6B");var M=l(a("2/Rp"));a("7Kak");var k=l(a("9yH6"));a("OaEy");var w=l(a("2fM7"));a("5NDa");var C=l(a("5rEg"));a("FJo9");var I=l(a("L41K"));a("y8nQ");var V=l(a("Vl3Y"));a("Znn+");var T=l(a("ZTPi"));a("iQDF");var D,A,R,L=l(a("+eQT")),H=r(a("q1tI")),F=a("MuoO"),P=l(a("wd/R")),Y=l(a("CkN6")),O=l(a("zHco")),x=l(a("m1+7")),N=l(a("MQ4l")),U=a("0bUC"),B=(l(a("j+jj")),l(a("itZA"))),z=a("34ay"),G=a("+n12"),q=l(a("fqRC")),j=l(a("67cV")),W=L.default.RangePicker,_=T.default.TabPane,K=(0,z.getAuthority)(),Z=V.default.Item,J=(I.default.Step,C.default.TextArea,w.default.Option),Q=(k.default.Group,["Unlock","lock"]),X=["Bicycle","Scooter","E-Bike","Car"],$={0:"Normal",1:"Error",3:"Deactivated",5:"Rebalance",6:"Maintain",7:"Out of Service"},ee=Object.keys($),te=function(e){var t=(0,P.default)(e).format("YYYY-MM-DD HH:mm:ss");return t},ae={vehicleId:"vehicleId",vehicleNumber:"vehicleNumber",vehicleType:"vehicleType",lockStatus:"lockStatus",reported:"reported",areaId:"areaId",imei:"imei",errorStatus:"errorStatus",connectStatus:"connectStatus",power:"power",vehiclePower:"vehiclePower",isTurnedOn:"isTurnedOn",heartTime:"heartTime",wirelessTech:"wirelessTech",lastRideTime:"lastRideTime",lastDropOffTime:"lastDropOffTime",mac:"mac",iccid:"iccid",firmware:"firmware",lat:"lat",lng:"lng"},le=["Mon","Tue","Weds","Thu","Fri","Sat","Sun"],re=["12AM","1AM","2AM","3AM","4AM","5AM","6AM","7AM","8AM","9AM","10AM","11AM","12PM","1PM","2PM","3PM","4PM","5PM","6PM","7PM","8PM","9PM","10PM","11PM"],ne=function(e){return e>=420?100:e<420&&e>=411?95+5*(e-411)/9:e<411&&e>=395?90+5*(e-395)/16:e<395&&e>=386?80+10*(e-386)/9:e<386&&e>=379?70+10*(e-379)/7:e<379&&e>=373?60+10*(e-373)/6:e<373&&e>=369?50+10*(e-369)/4:e<369&&e>=365?40+10*(e-365)/4:e<365&&e>=363?30+10*(e-363)/2:e<363&&e>=359?20+10*(e-359)/4:e<359&&e>=354?10+10*(e-354)/5:e<354&&e>340?10*(e-340)/14:0},ie=V.default.create()(function(e){var t=e.form,a=e.getheatmapData,l=e.isMobile,r=e.styles,n=(e.selectedAreaId,e.shouldShowHeatMap),i=e.clearHeatMap,d=e.getAreaCustomerSessionLocation,u=function(){t.validateFields(function(e,t){if(!e)if("customer"!==t.isStart){t.timeRange&&(t.start=(0,P.default)(t.timeRange[0]).utcOffset(0).format("MM-DD-YYYY HH:mm:ss"),t.end=(0,P.default)(t.timeRange[1]).utcOffset(0).format("MM-DD-YYYY HH:mm:ss"),t.timeRange=void 0),null!==t.endhour&&null!==t.startHour||(null!==t.endhour&&(t.startHour=0),null!==t.startHour&&(t.endHour=23));var l=(new Date).getTimezoneOffset()/60;t.offset=l,void 0!==t.startHour&&(t.startHour=(t.startHour+l)%24),void 0!==t.endHour&&(t.endHour=(t.endHour+l)%24),a(t)}else d(t)})},c=function(e,t){return t.props.children.toLowerCase().indexOf(e.toLowerCase())>=0},o=l?"80%":"7%",s=l?"3vw":"1vw",f=l?r.heatMapFilterMobile:r.heatMapFilter,m="customer"!==t.getFieldValue("isStart");return H.default.createElement("div",{style:{fontSize:s,marginTop:"1em"}},H.default.createElement("span",{className:f},t.getFieldDecorator("isStart",{initialValue:!0})(H.default.createElement(w.default,{defaultValue:!0},H.default.createElement(J,{value:!0},"Start of Ride"),H.default.createElement(J,{value:!1},"End of Ride"),H.default.createElement(J,{value:null}," Path of Ride "),H.default.createElement(J,{value:"customer"}," Customer "))),H.default.createElement("span",null," Time: "),t.getFieldDecorator("timeRange")(H.default.createElement(W,{style:{width:"20%"},format:"YYYY-MM-DD HH:mm:ss",showTime:!0}))),l&&H.default.createElement("br",null),m&&H.default.createElement("span",{className:f},H.default.createElement("span",null," Weekday : "),t.getFieldDecorator("weekday")(H.default.createElement(w.default,{placeholder:"select",style:{width:o,opacity:m?1:0},showSearch:!0,filterOption:c},le.map(function(e,t){return H.default.createElement(J,{value:t,key:t},e)})))),l&&H.default.createElement("br",null),m&&H.default.createElement("span",{className:f,style:{opacity:m?1:0}},H.default.createElement("span",null," Hours : "),t.getFieldDecorator("startHour")(H.default.createElement(w.default,{placeholder:"select",style:{width:o,opacity:m?1:0},showSearch:!0,filterOption:c},re.map(function(e,t){return H.default.createElement(J,{value:t,key:t},e)}))),"~",t.getFieldDecorator("endHour")(H.default.createElement(w.default,{placeholder:"select",style:{width:o,opacity:m?1:0},showSearch:!0,filterOption:c},re.map(function(e,t){return H.default.createElement(J,{value:t,key:t},e)})))),m&&H.default.createElement("span",{className:f,style:{opacity:m?1:0}},H.default.createElement("span",null," Type : "),t.getFieldDecorator("vehicleType")(H.default.createElement(w.default,{placeholder:"select",style:{width:o},filterOption:c},H.default.createElement(J,{value:0},"Bike"),H.default.createElement(J,{value:1},"Scooter"),H.default.createElement(J,{value:2},"E-Bike")))),l&&H.default.createElement("br",null),H.default.createElement("div",{style:{float:"right",marginTop:"1em"}},H.default.createElement(M.default,{style:{marginRight:"1vw"},htmlType:"submit",onClick:function(){t.resetFields(),i()}}," Reset "),n?H.default.createElement(M.default,{type:"primary",htmlType:"submit",onClick:u}," Get HeatMap "):H.default.createElement(S.default,{size:"middle",style:{marginRight:"0.5vw"}})))}),de=V.default.create()(function(e){var t=e.modalVisible,a=e.form,l=e.handleAdd,r=e.handleModalVisible,n=e.areas,i=function(){a.validateFields(function(e,t){e||(a.resetFields(),t.vehicleNumber=parseInt(t.vehicleNumber,10),l(t))})};return H.default.createElement(b.default,{destroyOnClose:!0,title:"Add",visible:t,onOk:i,onCancel:function(){return r()},width:"700px"},H.default.createElement(Z,{labelCol:{span:5},wrapperCol:{span:15},label:"ID"},a.getFieldDecorator("vehicleNumber",{rules:[{required:!0,message:"At least 8 Digits!",min:1}]})(H.default.createElement(C.default,{placeholder:"Please Input"}))),H.default.createElement(Z,{labelCol:{span:5},wrapperCol:{span:15},label:"IMEI"},a.getFieldDecorator("imei",{rules:[{required:!0,message:"At least 15 Digits!",min:1}]})(H.default.createElement(C.default,{placeholder:"Please Input"}))),H.default.createElement(Z,{labelCol:{span:5},wrapperCol:{span:15},label:"Mac Address"},a.getFieldDecorator("mac",{rules:[{required:!0,message:"At least 8 Digits!",min:1}]})(H.default.createElement(C.default,{placeholder:"Please Input"}))),H.default.createElement(Z,{labelCol:{span:5},wrapperCol:{span:15},label:"Type"},a.getFieldDecorator("vehicleType",{rules:[{required:!0,message:"You have pick a type"}]})(H.default.createElement(w.default,{placeholder:"select",style:{width:"100%"}},H.default.createElement(J,{value:"0"},"Bike"),H.default.createElement(J,{value:"1"},"Scooter"),H.default.createElement(J,{value:"2"},"E-Bike")))),n&&H.default.createElement(Z,{labelCol:{span:5},wrapperCol:{span:15},label:"Area"},a.getFieldDecorator("areaId",{rules:[{required:!0,message:"You have pick a area"}]})(H.default.createElement(w.default,{placeholder:"select",style:{width:"100%"}},n.map(function(e){return H.default.createElement(J,{key:e.id,value:e.id},e.name)})))))}),ue=V.default.create()(function(e){var t=e.form,a=e.modalVisible,l=e.handleUpdate,r=e.handleModalVisible,n=e.areas,i=e.record,d=function(){t.isFieldsTouched()?t.validateFields(function(e,a){e||(t.resetFields(),a.vehicleNumber=parseInt(a.vehicleNumber,10),Object.keys(a).map(function(e){i[e]===a[e]&&"areaId"!==e&&(a[e]=null)}),l(i.id,a,i))}):r()};return H.default.createElement(b.default,{destroyOnClose:!0,title:"Update",visible:a,onOk:d,onCancel:function(){return r()}},H.default.createElement(Z,{labelCol:{span:5},wrapperCol:{span:15},label:"ID"},t.getFieldDecorator("vehicleNumber",{rules:[{required:!0,message:"At least 8 Digits!",min:1}],initialValue:i.vehicleNumber+""})(H.default.createElement(C.default,{placeholder:"Please Input"}))),H.default.createElement(Z,{labelCol:{span:5},wrapperCol:{span:15},label:"Lock Status"},t.getFieldDecorator("lockStatus",{initialValue:i.lockStatus})(H.default.createElement(w.default,{placeholder:"select",style:{width:"100%"}},H.default.createElement(J,{value:0},"Unlock"),H.default.createElement(J,{value:1},"Lock")))),H.default.createElement(Z,{labelCol:{span:5},wrapperCol:{span:15},label:"Error Status"},t.getFieldDecorator("errorStatus",{initialValue:i.errorStatus+""})(H.default.createElement(w.default,{placeholder:"select",style:{width:"100%"}},ee.map(function(e){return H.default.createElement(J,{key:e,value:e,disabled:e>=5},$[e])})))),H.default.createElement(Z,{labelCol:{span:5},wrapperCol:{span:15},label:"Type"},t.getFieldDecorator("vehicleType",{rules:[{required:!0,message:"You have pick a type"}],initialValue:i.vehicleType})(H.default.createElement(w.default,{placeholder:"select",style:{width:"100%"}},H.default.createElement(J,{value:0},"Bike"),H.default.createElement(J,{value:1},"Scooter"),H.default.createElement(J,{value:2},"E-Bike")))),n&&H.default.createElement(Z,{labelCol:{span:5},wrapperCol:{span:15},label:"Area"},t.getFieldDecorator("areaId",{rules:[{required:!0,message:"You have pick a area"}],initialValue:i.areaId})(H.default.createElement(w.default,{placeholder:"select",style:{width:"100%"}},n.map(function(e){return H.default.createElement(J,{key:e.id,value:e.id},e.name)})))))}),ce=(D=(0,F.connect)(function(e){var t=e.vehicles,a=e.areas,l=e.loading,r=e.geo,n=e.global;return{vehicles:t,areas:a.data,selectedAreaId:a.selectedAreaId,loading:l.models.vehicles,areaNames:a.areaNames,isMobile:n.isMobile,geo:r}}),A=V.default.create(),D(R=A(R=function(e){function t(){var e,a;(0,h.default)(this,t);for(var l=arguments.length,r=new Array(l),n=0;n<l;n++)r[n]=arguments[n];return a=(0,E.default)(this,(e=(0,y.default)(t)).call.apply(e,[this].concat(r))),a.state={modalVisible:!1,updateModalVisible:!1,detailModalVisible:!1,expandForm:!1,selectedRows:[],vehicleLocations:[],filterCriteria:{currentPage:1,pageSize:10},selectedRecord:{},selectedMarker:null,selectedTab:"1",shouldShowHeatMap:!0,shoudlShowVehicles:!0,heatMapMaxIntensity:0,heatMapRadius:15,todayRange:{start:(0,P.default)().startOf("day").format("MM-DD-YYYY HH:mm:ss"),end:(0,P.default)().endOf("day").format("MM-DD-YYYY HH:mm:ss")}},a.columns=[{title:"ID",dataIndex:"vehicleNumber"},{title:"Power",dataIndex:"power",render:function(e){return H.default.createElement("p",null,(0,U.roundTo2Decimal)(ne(e))+"%")}},{title:"Status",dataIndex:"connectStatus",render:function(e,t){return H.default.createElement(H.Fragment,null,H.default.createElement("span",null,Q[t.lockStatus]),H.default.createElement(p.default,{type:"vertical"}),H.default.createElement("span",null,$[t.errorStatus]),H.default.createElement(p.default,{type:"vertical"}),H.default.createElement("span",null,a.isConnected(t)))}},{title:"HeartTime",dataIndex:"heartTime",sorter:!0,render:function(e){return H.default.createElement("span",null,te(e))}},{title:"Ride Count",dataIndex:"rideCount",sorter:!0,render:function(e){return H.default.createElement("span",null,e)}},{title:"Last Ride Time",dataIndex:"lastRideTime",sorter:!0,render:function(e){return H.default.createElement("span",null,(0,P.default)(e).format("YYYY-MM-DD HH:mm:ss"))}},{title:"Last Drop Off Time",dataIndex:"lastDropOffTime",sorter:!0,render:function(e){return H.default.createElement("span",null,(0,P.default)(e).format("YYYY-MM-DD HH:mm:ss"))}},{title:"Type",dataIndex:"vehicleType",render:function(e){return H.default.createElement("p",null,X[e])}},{title:"Vehicle Power",dataIndex:"vehiclePower",render:function(e){return H.default.createElement("p",null,"".concat(e,"%"))}},{title:"Chain Lock",dataIndex:"chainLockStatus",render:function(e){return H.default.createElement("p",null,"".concat(null!==e?Q[e]:"null"))}},{title:"operation",render:function(e,t){return H.default.createElement(H.Fragment,null,H.default.createElement("a",{onClick:function(){return a.handleUpdateModalVisible(!0,t)}},"Update"),H.default.createElement(p.default,{type:"vertical"}),H.default.createElement("a",{onClick:function(){return a.handleDetailModalVisible(!0,t)}},"Detail"))}}],a.handleResponsiveItemClick=function(e){a.setState({selectedVehicleId:e===a.state.selectedVehicleId?null:e})},a.handleResponsivePageChange=function(e,t){var l=a.props.dispatch,r=a.state.filterCriteria,n=(0,m.default)({},r);n.currentPage=e,n.pageSize=t,a.setState({filterCriteria:n}),l({type:"vehicles/get",payload:n})},a.handleSetSelectedVehicleRefresh=function(e){a.setState({selectedVehicleRefresh:e})},a.changeLockStatus=function(e){var t=a.props,l=t.dispatch,r=t.isMobile;if(r)1===e.lockStatus?a.setState({unlockModalVisible:!0,readyToUnlockVehicle:e}):a.handleApplyingPickUpAction(0,e);else{var n=1===e.lockStatus?"vehicles/unlock":"vehicles/lock";("vehicles/unlock"===n&&K.includes("unlock.vehicle")||"vehicles/lock"===n&&K.includes("lock.vehicle"))&&l({type:n,id:e.id,onSuccess:function(){setTimeout(function(){a.handleSearch()},3e3)}})}},a.updateLocation=function(e){var t=a.props.dispatch;t({type:"vehicles/updateLocation",id:e,onSuccess:function(){setTimeout(function(){a.handleSetSelectedVehicleRefresh(!0)},4e3)}})},a.alertVehicle=function(e){var t=a.props.dispatch;t({type:"vehicles/alertVehicle",vehicleId:e})},a.clearHeatMap=function(){a.setState({heatmapData:void 0,shoudlShowVehicles:!0})},a.getResponsiveVehicleInfo=function(e,t){var l=a.state.selectedVehicleRefresh,r=(0,U.roundTo2Decimal)(ne(e.power)),n=0===e.vehicleType?r:e.vehiclePower,i=function(e){return e>60?"#04e508":e<40?"#e81309":"#EFAF13"},d=t===e.id;return H.default.createElement("div",{key:e.id,style:{textAlign:"center",fontSize:"3.5vw"}},H.default.createElement(o.default,null,H.default.createElement(f.default,{span:6},X[e.vehicleType]),d&&H.default.createElement(f.default,{offset:16,span:2},H.default.createElement(s.default,{type:"redo",onClick:function(){a.handleSearch(),a.handleSetSelectedVehicleRefresh(!0)}}))),d&&H.default.createElement(o.default,{style:{marginTop:"1em"}},H.default.createElement(N.default,{record:e,selectedVehicleRefresh:l,handleSetSelectedVehicleRefresh:a.handleSetSelectedVehicleRefresh})),d&&H.default.createElement(o.default,{style:{marginTop:"1em"}},H.default.createElement(f.default,{span:12}," Lock Power : ",H.default.createElement("span",{style:{color:i(r)}}," ",r," % "),"  "),H.default.createElement(f.default,{span:12}," Vehicle Power : ",H.default.createElement("span",{style:{color:i(e.vehiclePower)}},"  ",e.vehiclePower," % "),"  ")),d&&H.default.createElement(o.default,{style:{marginTop:"1em"}},H.default.createElement(f.default,{span:8},"Ride Count"),H.default.createElement(f.default,{span:8},"Heart Time"),H.default.createElement(f.default,{span:8},"Last Ride")),d&&H.default.createElement(o.default,null,H.default.createElement(f.default,{span:8},e.rideCount),H.default.createElement(f.default,{span:8},(0,P.default)(e.heartTime).format("YYYY-MM-DD HH:mm:ss")),H.default.createElement(f.default,{span:8},(0,P.default)(e.lastRideTime).format("YYYY-MM-DD HH:mm:ss"))),H.default.createElement(o.default,{style:{marginTop:"1em"}},H.default.createElement(f.default,{span:6}," ",e.vehicleNumber," "),H.default.createElement(f.default,{span:11},H.default.createElement("span",null,H.default.createElement(s.default,{type:1===e.lockStatus?"lock":"unlock",style:{color:1===e.lockStatus?"blue":"orange"}})," | "),H.default.createElement("span",{style:{color:0===e.errorStatus?"#04e508":"red"}},$[e.errorStatus])," | ",H.default.createElement("span",{style:{color:1===e.connectStatus?"#04e508":"red"}},a.isConnected(e))),H.default.createElement(f.default,{span:7},"Battery: ",H.default.createElement("span",{style:{color:i(n)}}," ",n+"%"," ")," ")),d&&H.default.createElement(o.default,{style:{marginTop:"1em"}},H.default.createElement(f.default,{span:5},K.includes("unlock.vehicle")?H.default.createElement("a",{onClick:function(){return a.changeLockStatus(e)}},0===e.lockStatus&&1===e.vehicleType?"Lock":"Unlock"):H.default.createElement("span",{style:{color:"grey"}},0===e.lockStatus&&1===e.vehicleType?"Lock":"Unlock")),H.default.createElement(f.default,{span:5,style:{fontSize:"2.5vw"}},K.includes("update.vehicle.location")?H.default.createElement("a",{onClick:function(){return a.updateLocation(e.id)}},"Update Location"):H.default.createElement("span",{style:{color:"grey"}},"Update Location")),H.default.createElement(f.default,{span:5},K.includes("alert.vehicle")?H.default.createElement("a",{onClick:function(){return a.alertVehicle(e.id)}},"Beep"):H.default.createElement("span",{style:{color:"grey"}},"Beep")),H.default.createElement(f.default,{span:5},H.default.createElement("a",{onClick:function(){return a.handleUpdateModalVisible(!0,e)}},"Update")),H.default.createElement(f.default,{span:4},H.default.createElement("a",{onClick:function(){return a.handleDetailModalVisible(!0,e)}},"Detail"))),H.default.createElement(o.default,{style:{marginTop:"1em",marginBottom:"0px"},onClick:function(){return a.handleResponsiveItemClick(e.id)}},d?H.default.createElement(s.default,{type:"up"}):H.default.createElement(s.default,{type:"down"})))},a.handleGetListVehicles=function(){var e=a.props.dispatch,t=a.state.filterCriteria;e({type:"vehicles/getCount",payload:t}),e({type:"vehicles/get",payload:t})},a.handleStandardTableChange=function(e,t,l){var r=a.props.dispatch,n=a.state.filterCriteria,i=(0,m.default)({},n);i.currentPage=e.current,i.pageSize=e.pageSize,l.field&&(i.sorter="".concat(l.field,"_").concat(l.order)),a.setState({filterCriteria:i}),r({type:"vehicles/get",payload:i})},a.handleFormReset=function(){var e=a.props,t=e.form,l=(e.dispatch,a.state.filterCriteria);t.resetFields();var r={currentPage:1,pageSize:l.pageSize};a.setState({filterCriteria:r},function(){return a.handleSearch()})},a.toggleForm=function(){var e=a.state.expandForm;a.setState({expandForm:!e})},a.handleSearch=function(e){"object"===typeof e&&e.preventDefault();var t=a.props,l=(t.dispatch,t.form),r=t.selectedAreaId,n=a.state,i=n.filterCriteria,d=n.selectedTab;l.validateFields(function(e,t){if(!e){var l=Object.assign({},i,t,{currentPage:1,pageSize:10,areaId:r});t.vehiclePowerCustom&&(l.vehiclePower=t.vehiclePowerCustom),a.setState({filterCriteria:l},function(){switch(d){case"1":a.handleGetListVehicles();break;case"2":a.handleGetMapData();break;default:return}})}})},a.handleUpdateAllLocations=function(e){"object"===typeof e&&e.preventDefault();var t=a.props,l=t.dispatch,r=t.form,n=t.selectedAreaId,i=a.state,d=i.filterCriteria;i.selectedTab;r.validateFields(function(e,t){if(!e){var r=Object.assign({},d,t,{currentPage:1,pageSize:10,areaId:n});a.setState({filterCriteria:r},function(){return l({type:"vehicles/updateAllLocations",payload:d,areaId:n})})}})},a.getAreaCustomerSessionLocation=function(e){var t=a.props,l=t.dispatch,r=t.selectedAreaId;l({type:"vehicles/getAreaSessionLocation",areaId:r,onSuccess:function(e){return a.setState({heatmapData:e,heatmapType:"customer",shouldShowHeatMap:!0,heatMapMaxIntensity:2*(Math.floor(e.length/1e3)+1)})},fieldsValue:e})},a.handleModalVisible=function(e){a.setState({createModalVisible:!!e})},a.handleUpdateModalVisible=function(e,t){a.setState({updateModalVisible:!!e,selectedRecord:t||{}})},a.handleDetailModalVisible=function(e,t){a.setState({detailModalVisible:!!e,selectedRecord:t||{}})},a.handleDeleteModalVisible=function(e,t){a.setState({updateModalVisible:!!e,selectedRecord:t||{}})},a.handleAdd=function(e){var t=a.props.dispatch;t({type:"vehicles/add",payload:e}),a.handleModalVisible()},a.handleApplyingPickUpAction=function(e,t){var l=a.props,r=l.dispatch,n=l.isMobile;if(K.includes("apply.action"))if(n){var i={};switch(i.actionType=e>=5?0:1,e){case 5:i.reasonType=1;break;case 6:i.reasonType=2;break;case 7:i.reasonType=0;break;default:break}navigator.geolocation?navigator.geolocation.getCurrentPosition(function(e){i.location={lat:e.coords.latitude,lng:e.coords.longitude},r({type:"vehicles/applyAction",payload:i,id:t.id,vehicleNumber:t.vehicleNumber,onSuccess:a.handleGetListVehicles})}):error.message("You have to enable to gps location to apply action to vehicle.")}else c.default.error("can't apply action to vehicle on pc.");else c.default.error("You don't have permmision to apply action to this vehicle.")},a.handleUpdate=function(e,t){var l=a.props,r=l.dispatch;l.isMobile;r({type:"vehicles/update",payload:t,id:e,onSuccess:a.handleGetListVehicles}),a.handleUpdateModalVisible()},a.getAreaGeoInfo=function(){var e=a.props,t=e.dispatch,l=e.selectedAreaId;t({type:"geo/getFences",areaId:l}),t({type:"geo/getCenter",areaId:l})},a.setClickedMarker=function(e){a.setState({selectedMarker:e})},a.hadnleTabChange=function(e){a.setState({selectedTab:e},a.handleSearch)},a.getheatmapData=function(e){var t,l=a.props,r=l.dispatch,n=l.selectedAreaId;a.setState({shouldShowHeatMap:!1}),r((t={type:"vehicles/getStartPoints",areaId:n,params:e},(0,u.default)(t,"params",e),(0,u.default)(t,"onSuccess",function(t){return a.setState({heatmapData:t,heatmapType:e.isStart,shouldShowHeatMap:!0,heatMapMaxIntensity:2*(Math.floor(t.length/1e3)+1)})}),t))},a.handleGetMapData=function(){var e=a.props.selectedAreaId;e>=1&&(a.getVehicleLocations(),a.getAreaGeoInfo())},a.formatCsvData=function(e){return e.map(function(e){return e.heartTime=(0,P.default)(e.heartTime).format("YYYY-MM-DD HH:mm:ss"),e.lastRideTime=e.lastRideTime?(0,P.default)(1e3*e.lastRideTime).format("YYYY-MM-DD HH:mm:ss"):null,e.lastDropOffTime=e.lastDropOffTime?(0,P.default)(1e3*e.lastDropOffTime).format("YYYY-MM-DD HH:mm:ss"):null,e})},a.handleSetHeatMapMaxIntensity=function(e){a.setState({heatMapMaxIntensity:e})},a.handleSetHeatMapRadius=function(e){a.setState({heatMapRadius:e})},a.handleGetMyLocation=function(e){if(e.target.checked){if(navigator.geolocation){navigator.geolocation.getCurrentPosition(function(e){return a.setState({currPosition:e})});var t=navigator.geolocation.watchPosition(function(e){return a.setState({currPosition:e})},function(e){return console.log(e)},{enableHighAccuracy:!0,timeout:1e4});a.setState({watchId:t})}}else navigator.geolocation&&navigator.geolocation.clearWatch(a.state.watchId),a.setState({currPosition:null,watchId:null})},a.handleShowingVehicles=function(e){a.setState({shoudlShowVehicles:e.target.checked})},a}return(0,g.default)(t,e),(0,v.default)(t,[{key:"componentDidMount",value:function(){if(this.handleSearch(),this.props.isMobile){var e=document.getElementById("numberOrImei");e&&(e.setAttribute("type","number"),e.setAttribute("pattern","[0-9]*"))}}},{key:"isConnected",value:function(e){return 1===e.connectStatus?"online":"offline"}},{key:"componentDidUpdate",value:function(e,t,a){e.selectedAreaId!==this.props.selectedAreaId&&this.handleSearch()}},{key:"renderSimpleForm",value:function(){var e=this.props.form.getFieldDecorator;return H.default.createElement(V.default,{onSubmit:this.handleSearch,layout:"inline"},H.default.createElement(o.default,{gutter:{md:8,lg:24,xl:48}},H.default.createElement(f.default,{md:8,sm:24},H.default.createElement(Z,{label:"Keywords"},e("numberOrImei")(H.default.createElement(C.default,{placeholder:"number or imei"})))),H.default.createElement(f.default,{md:8,sm:24},H.default.createElement(Z,{label:"Battery Status"},e("lockPower")(H.default.createElement(w.default,{placeholder:"select",style:{width:"100%"}},H.default.createElement(J,{value:"0"},"Low Battery"),H.default.createElement(J,{value:"1"},"Full Battery"),H.default.createElement(J,{value:null},"All"))))),H.default.createElement(f.default,{md:8,sm:24},H.default.createElement(Z,{label:"Connection Status"},e("connectStatus")(H.default.createElement(w.default,{placeholder:"select",style:{width:"100%"}},H.default.createElement(J,{value:"0"},"offline"),H.default.createElement(J,{value:"1"},"online"),H.default.createElement(J,{value:null},"All")))))),H.default.createElement("div",{style:{overflow:"hidden"}},H.default.createElement("div",{style:{float:"right",marginBottom:24}},H.default.createElement(M.default,{type:"primary",htmlType:"submit"},"Search"),H.default.createElement(M.default,{style:{marginLeft:8},onClick:this.handleFormReset},"Reset"),H.default.createElement("a",{style:{marginLeft:8},onClick:this.toggleForm},"more ",H.default.createElement(s.default,{type:"down"})))))}},{key:"renderAdvancedForm",value:function(){var e=this.props.form.getFieldDecorator,t=(this.props.areas,function(e,t,a){void 0===t||t>0&&Number.isInteger(t)?a():a("Number must be larger than zero.")});return H.default.createElement(V.default,{onSubmit:this.handleSearch,layout:"inline"},H.default.createElement(o.default,{gutter:{md:8,lg:24,xl:48}},H.default.createElement(f.default,{md:8,sm:24},H.default.createElement(Z,{label:"Keywords"},e("numberOrImei")(H.default.createElement(C.default,{className:"number_or_imei_input",placeholder:"number or imei"})))),H.default.createElement(f.default,{md:8,sm:24},H.default.createElement(Z,{label:"Lock Battery Status"},e("lockPower")(H.default.createElement(w.default,{placeholder:"select",style:{width:"100%"}},H.default.createElement(J,{value:"0"},"Low Battery"),H.default.createElement(J,{value:"1"},"Full Battery"),H.default.createElement(J,{value:null},"All"))))),H.default.createElement(f.default,{md:8,sm:24},H.default.createElement(Z,{label:"Connection Status"},e("connectStatus")(H.default.createElement(w.default,{placeholder:"select",style:{width:"100%"}},H.default.createElement(J,{value:"0"},"offline"),H.default.createElement(J,{value:"1"},"online"),H.default.createElement(J,{value:null},"All")))))),H.default.createElement(o.default,{gutter:{md:8,lg:24,xl:48}},H.default.createElement(f.default,{md:8,sm:24},H.default.createElement(Z,{label:"Lock Status"},e("lockStatus")(H.default.createElement(w.default,{placeholder:"select",style:{width:"100%"}},H.default.createElement(J,{value:"0"},"Unlock"),H.default.createElement(J,{value:"1"},"Lock"),H.default.createElement(J,{value:null},"All"))))),H.default.createElement(f.default,{md:8,sm:24},H.default.createElement(Z,{label:"Vehicle Type"},e("vehicleType")(H.default.createElement(w.default,{placeholder:"select",style:{width:"100%"}},H.default.createElement(J,{value:"0"},"Bike"),H.default.createElement(J,{value:"1"},"Scooter"),H.default.createElement(J,{value:"2"},"e-bike"),H.default.createElement(J,{value:null},"All"))))),H.default.createElement(f.default,{md:8,sm:24},H.default.createElement(Z,{label:"Error Status"},e("errorStatus",{initialValue:["0","1","5","6","7"]})(H.default.createElement(w.default,{mode:"multiple",placeholder:"select",style:{width:"100%"}},ee.map(function(e){return H.default.createElement(J,{value:e,key:e},$[e])})))))),H.default.createElement(o.default,{gutter:{md:8,lg:24,xl:48}},H.default.createElement(f.default,{md:8,sm:24},H.default.createElement(Z,{label:"Is Using"},e("isUsing")(H.default.createElement(w.default,{placeholder:"select",style:{width:"100%"}},H.default.createElement(J,{value:!0},"Yes"),H.default.createElement(J,{value:!1},"No"),H.default.createElement(J,{value:null},"All"))))),H.default.createElement(f.default,{md:8,sm:24},H.default.createElement(Z,{label:"Vehicle Power Status"},e("vehiclePower")(H.default.createElement(w.default,{placeholder:"select",style:{width:"100%"}},H.default.createElement(J,{value:"0"},"Low Battery"),H.default.createElement(J,{value:"1"},"Full Battery"),H.default.createElement(J,{value:null},"All"))))),H.default.createElement(f.default,{md:8,sm:24},H.default.createElement(Z,{labelCol:{span:5},wrapperCol:{span:15},label:"Idle Days"},e("idleType",{initialValue:null})(H.default.createElement(w.default,{placeholder:"select",style:{width:"50%"}},H.default.createElement(J,{value:1},"Last Ride Time"),H.default.createElement(J,{value:2},"Last Drop Off Time"),H.default.createElement(J,{value:null},"Both"))),e("idleDays",{rules:[{validator:t}]})(H.default.createElement(d.default,{placeholder:"Please Input",style:{marginLeft:"1em"}}))))),H.default.createElement(o.default,{gutter:{md:8,lg:24,xl:48}},H.default.createElement(f.default,{md:8,sm:24},H.default.createElement(Z,{label:"Is Reported"},e("isReported")(H.default.createElement(w.default,{placeholder:"select",style:{width:"100%"}},H.default.createElement(J,{value:!0},"Yes"),H.default.createElement(J,{value:!1},"No"),H.default.createElement(J,{value:null},"All"))))),H.default.createElement(f.default,{md:12,sm:24},H.default.createElement(Z,{label:"Custom Vehicle Power Search:"},e("vehiclePowerCustom")(H.default.createElement(d.default,{placeholder:"power"}))," %"))),H.default.createElement("div",{style:{overflow:"hidden"}},H.default.createElement("div",{style:{float:"right",marginBottom:24}},H.default.createElement(M.default,{type:"primary",htmlType:"submit"},"Search"),H.default.createElement(M.default,{style:{marginLeft:8},onClick:this.handleFormReset},"Reset"),H.default.createElement("a",{style:{marginLeft:8},onClick:this.toggleForm},"close ",H.default.createElement(s.default,{type:"up"})))))}},{key:"renderForm",value:function(){var e=this.state.expandForm;return e?this.renderAdvancedForm():this.renderSimpleForm()}},{key:"getVehicleLocations",value:function(){var e=this,t=this.props,a=t.dispatch,l=(t.selectedAreaId,this.state.filterCriteria);a({type:"vehicles/getVehicleLocation",payload:l,onSuccess:function(t){return e.setState({vehicleLocations:t})}})}},{key:"render",value:function(){var e=this,t=this.props,a=t.vehicles,l=t.areas,r=t.loading,d=t.selectedAreaId,u=t.geo,s=t.areaNames,m=t.dispatch,p=u.area&&u.area.center,h=u.fences,v=this.state,E=v.createModalVisible,y=v.updateModalVisible,g=v.detailModalVisible,S=v.selectedRecord,k=v.filterCriteria,w=v.selectedMarker,C=v.selectedTab,I=v.vehicleLocations,V=v.heatmapData,D=v.heatmapType,A=v.shouldShowHeatMap,R=v.selectedVehicleId,F=v.selectedVehicleRefresh,N=v.heatMapMaxIntensity,U=v.heatMapRadius,z=v.currPosition,W=v.shoudlShowVehicles,Z={handleAdd:this.handleAdd,handleModalVisible:this.handleModalVisible},J={handleModalVisible:this.handleUpdateModalVisible,handleUpdate:this.handleUpdate},Q={defaultCurrent:1,current:k.currentPage,pageSize:k.pageSize,total:a.total};return H.default.createElement(O.default,{title:"Vehicle List"},H.default.createElement(i.default,{bordered:!1},H.default.createElement("div",{className:x.default.tableList},H.default.createElement("div",{className:x.default.tableListForm},this.renderForm()),H.default.createElement("div",{className:x.default.tableListOperator},H.default.createElement(M.default,{icon:"plus",type:"primary",onClick:function(){return e.handleModalVisible(!0)}},"Add"),d>=1&&K.includes("update.all.vehicle.location")&&H.default.createElement(M.default,{type:"primary",onClick:function(){return e.handleUpdateAllLocations()}},"Update All Locations"),H.default.createElement("span",{style:{marginLeft:"1em"}},"count: ".concat("1"===C?a.total:I.length))),H.default.createElement(T.default,{defaultActiveKey:"1",onChange:this.hadnleTabChange},H.default.createElement(_,{tab:"List View",key:"1"},this.props.isMobile?H.default.createElement(j.default,{vehicles:a.data,selectedVehicleId:R,getResponsiveVehicleInfo:this.getResponsiveVehicleInfo,selectedVehicleRefresh:F,totalCount:a.total,onPageChange:this.handleResponsivePageChange}):H.default.createElement(Y.default,{loading:r,data:{list:a.data,pagination:Q},columns:this.columns,onChange:this.handleStandardTableChange,scroll:{x:1300}}),H.default.createElement(o.default,null,H.default.createElement(f.default,{span:6}," ",H.default.createElement(L.default,{defaultValue:(0,P.default)(),onChange:function(t){e.setState({todayRange:{start:t.startOf("day").format("MM-DD-YYYY HH:mm:ss"),end:t.endOf("day").format("MM-DD-YYYY HH:mm:ss")}})}})),H.default.createElement(f.default,{span:6},H.default.createElement(M.default,{onClick:function(){return m({type:"vehicles/getVehicleSnapshot",payload:Object.assign({},e.state.todayRange,{areaId:d}),onSuccess:function(t){if(Array.isArray(t)&&t.length<=0)c.default.error("Snapshot doesn't exits");else{var a={vehicleId:"id",imei:"imei",vehicleNumber:"vehicleNumber",vehicleType:"vehicleType",areaName:"Area",errorStatus:"errorStatus",batteryLevel:"batteryLevel",isConnected:"isConnected",lastRideIdleHour:"lastRideIdleHour",isInGeoFence:"isInGeoFence",lastDropOffIdleHour:"lastDropOffIdleHour",primeLocationId:"Hub Id",created:"Created"},l=t.map(function(e){return e.vehicleType=null!==e.vehicleType?X[e.vehicleType]:null,e.areaName=null!==e.areaId?s[e.areaId]:null,e.isInGeoFence=null===e.locationStatus?"Unknown":0===e.locationStatus,e.errorStatus=$[e.errorStatus],e.created=te(e.created)+" "+Intl.DateTimeFormat().resolvedOptions().timeZone,e});(0,G.exportCSVFile)(a,l,e.state.todayRange.start.split(" ")[0]+"-"+(null===d?"All":s[d])+"-vehicle-snapshot")}}})}},"Export Vehicle Snapshot")),H.default.createElement(f.default,{span:6},H.default.createElement(M.default,{onClick:function(){return m({type:"vehicles/getPrimLocationSnapshot",payload:Object.assign({},e.state.todayRange,{areaId:d}),onSuccess:function(t){if(Array.isArray(t)&&t.length<=0)c.default.error("Snapshot doesn't exits");else{var a={id:"Hub ID",description:"Hub Description",lat:"Lat",lng:"Lng",market:"Market",radius:"Radius(ft)",target:"Target",minimum:"Mimimum",total:"Number of Vehicles in Hub",created:"Created"},l=t.map(function(e){return e.id=e.primeLocationId,e.market=null!==e.areaId?s[e.areaId]:null,e.radius=null===e.radius?null:328*e.radius/100,e.created=te(e.created)+" "+Intl.DateTimeFormat().resolvedOptions().timeZone,e});(0,G.exportCSVFile)(a,l,e.state.todayRange.start.split(" ")[0]+"-"+(null===d?"All":s[d])+"-Hub-Snapshot")}}})}},"Export Vehicle Hub Snapshot")))),d>=1&&H.default.createElement(_,{tab:"Map View",key:"2"},p&&h&&H.default.createElement(q.default,{center:p,vehicles:I,fences:h,heatMapData:V,heatmapType:D,shouldShowHeatMap:A,handleGetMapData:this.handleGetMapData,styles:x.default,heatMapMaxIntensity:N,heatMapRadius:U,handleSetHeatMapMaxIntensity:this.handleSetHeatMapMaxIntensity,handleSetHeatMapRadius:this.handleSetHeatMapRadius,currPosition:z,handleGetMyLocation:this.handleGetMyLocation,handleShowingVehicles:this.handleShowingVehicles,shoudlShowVehicles:W,vehicleTypeFilter:{unlock:!0,lock:!0,lowBattery:!0,error:!0,errorUnlock:!0,ebike:!0},setClickedMarker:this.setClickedMarker,selectedMarker:w}),K.includes("get.area.start.points")&&!this.props.isMobile&&H.default.createElement(ie,{isMobile:this.props.isMobile,styles:x.default,getheatmapData:this.getheatmapData,shouldShowHeatMap:A,clearHeatMap:this.clearHeatMap,selectedAreaId:d,getAreaCustomerSessionLocation:this.getAreaCustomerSessionLocation}),I.length>0&&H.default.createElement(M.default,{style:{marginTop:"1em"},onClick:function(){return(0,G.exportCSVFile)(ae,e.formatCsvData(I),s[d])}},"Export"))))),H.default.createElement(de,(0,n.default)({},Z,{modalVisible:E,areas:l})),H.default.createElement(ue,(0,n.default)({},J,{modalVisible:y,record:S,areas:l})),g&&H.default.createElement(B.default,{isVisible:g,handleDetailVisible:this.handleDetailModalVisible,vehicleId:S.id,handleGetVehicles:this.handleGetListVehicles}),H.default.createElement(b.default,{footer:null,visible:this.props.isMobile&&this.state.unlockModalVisible,destroyOnClose:!0,onCancel:function(){return e.setState({unlockModalVisible:!1})},title:"Purpose for Unlock"},[5,6,7].map(function(t){return H.default.createElement(o.default,{style:{textAlign:"center",marginTop:"2em"}},H.default.createElement(M.default,{style:{width:"80vw"},type:"primary",onClick:function(){return e.handleApplyingPickUpAction(t,e.state.readyToUnlockVehicle)}},$[t]))})))}}]),t}(H.PureComponent))||R)||R),oe=ce;t.default=oe}}]);