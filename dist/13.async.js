(window["webpackJsonp"]=window["webpackJsonp"]||[]).push([[13],{BzdX:function(e,t,a){"use strict";var n=a("TqRt"),r=a("284h");Object.defineProperty(t,"__esModule",{value:!0}),t.default=void 0,a("IzEo");var i=n(a("bx4M")),l=n(a("lwsE")),c=n(a("W8MJ")),s=n(a("a1gu")),o=n(a("Nsbk")),u=n(a("7W2i")),d=n(a("pVnL")),f=n(a("J4zp")),m=n(a("QILm"));a("Znn+");var p=n(a("ZTPi"));a("iQDF");var h,g,k=n(a("+eQT")),v=r(a("q1tI")),y=a("MuoO"),D=a("LLXN"),E=a("34ay"),I=n(a("CkN6")),M=n(a("v99g")),P=a("+n12"),A=a("eHHv"),w=a("PQp+"),C=a("1pet"),S=n(a("wd/R")),T=n(a("rBGm")),b=v.default.Fragment,N={lat:41.879658,lng:-87.629769},x=k.default.RangePicker,O=(0,E.getAuthority)(),R=p.default.TabPane,V=function(e){var t=e.actionType,a=e.date,n=e.name,r=(0,m.default)(e,["actionType","date","name"]),i=(0,v.useState)(!1),l=(0,f.default)(i,2),c=l[0],s=l[1],o=function(){s(!c)};return v.default.createElement(w.Marker,(0,d.default)({},r,{onMouseOut:o,onMouseOver:o}),c&&v.default.createElement(w.InfoWindow,null,v.default.createElement(b,null,v.default.createElement("h4",null,n),v.default.createElement("h5",null,a),v.default.createElement("h5",null,t))))},B=(h=(0,y.connect)(function(e){var t=e.areas,a=e.performance,n=e.geo;return{geo:n,performance:a,selectedAreaId:t.selectedAreaId,areaNames:t.areaNames}}),h(g=function(e){function t(e){var a;return(0,l.default)(this,t),a=(0,s.default)(this,(0,o.default)(t).call(this,e)),a.state={rangePickerValue:(0,P.getTimeDistance)("month")},a.columns=[{title:"First Name",dataIndex:"firstName"},{title:"Last Name",dataIndex:"lastName"},{title:"Battery Swap Pickups",dataIndex:"actionData.batterySwapPickUpCount",sorter:!0},{title:"Battery Swap Dropoffs",dataIndex:"actionData.batterySwapDropOffCount",sorter:!0},{title:"Maintenance Pickups",dataIndex:"actionData.maintenancePickUpCount",sorter:!0},{title:"Maintenance Dropoffs",dataIndex:"actionData.maintenanceDropOffCount",sorter:!0},{title:"Rebalance Pickups",dataIndex:"actionData.rebalancePickUpCount",sorter:!0},{title:"Rebalance Dropoffs",dataIndex:"actionData.rebalanceDropOffCount",sorter:!0}],a.setClickedMarker=function(e){a.setState({selectedMarker:e})},a.selectDate=function(e){a.setState({rangePickerValue:(0,P.getTimeDistance)(e)})},a.handleRangePickerChange=function(e){a.props.dispatch;a.setState({rangePickerValue:e},a.loadBarCharData)},a.countTechPickups=function(e){var t=a.props.performance.technicianMetricsData;if(void 0===t||null===t)return"N/A";t.reduce(function(t,a){return parseInt(a[e])+t},0)},a.getAreaGeoInfo=function(){var e=a.props.selectedAreaId,t=a.props.dispatch;t({type:"geo/getCenter",areaId:e})},a}return(0,u.default)(t,e),(0,c.default)(t,[{key:"componentDidMount",value:function(){this.getTechnicianData()}},{key:"componentWillUnmount",value:function(){var e=this.props.dispatch;e({type:"dashboard/clear"}),cancelAnimationFrame(this.reqRef),clearTimeout(this.timeoutId),clearInterval(this.pollingId)}},{key:"getRangeEnd",value:function(e){var t=(0,S.default)();return e.diff(t,"seconds")>0?t:e}},{key:"getTechnicianData",value:function(){var e=this.props,t=e.dispatch,a=e.selectedAreaId,n=this.state.rangePickerValue;O.includes("get.technician.metrics")&&(console.log(n[0].toISOString()),console.log(n[1].toISOString()),t({type:"performance/getTechnicianMetricsData",params:Object.assign({},{areaId:a||-1,startDate:n[0].toISOString(),end:n[1].toISOString()})}))}},{key:"componentDidUpdate",value:function(e,t,a){t.rangePickerValue!==this.state.rangePickerValue&&this.getTechnicianData(),e.selectedAreaId!==this.props.selectedAreaId&&(this.getTechnicianData(),this.getAreaGeoInfo())}},{key:"isActive",value:function(e){var t=this.state.rangePickerValue,a=(0,P.getTimeDistance)(e);return t[0]&&t[1]&&t[0].isSame(a[0],"day")&&t[1].isSame(a[1],"day")?T.default.currentDate:""}},{key:"render",value:function(){var e=this,t=this.props.performance,a=t.technicianMetricsData,n=v.default.createElement("div",{className:T.default.salesExtraWrap},v.default.createElement("div",{className:T.default.salesExtra},v.default.createElement("a",{className:this.isActive("day"),onClick:function(){return e.selectDate("day")}},v.default.createElement(D.FormattedMessage,{id:"app.analysis.all-day",defaultMessage:"All Day"})),v.default.createElement("a",{className:this.isActive("week"),onClick:function(){return e.selectDate("week")}},v.default.createElement(D.FormattedMessage,{id:"app.analysis.all-week",defaultMessage:"All Week"})),v.default.createElement("a",{className:this.isActive("month"),onClick:function(){return e.selectDate("month")}},v.default.createElement(D.FormattedMessage,{id:"app.analysis.all-month",defaultMessage:"All Month"})),v.default.createElement("a",{className:this.isActive("year"),onClick:function(){return e.selectDate("year")}},v.default.createElement(D.FormattedMessage,{id:"app.analysis.all-year",defaultMessage:"All Year"}))),v.default.createElement(x,{value:this.state.rangePickerValue,onChange:this.handleRangePickerChange,style:{width:256}})),r=function(){if(a){var e=a.map(function(e){var t=e.actionData.actions,a=e.technicianId,n=t.map(function(t){return{name:"".concat(e.firstName," ").concat(e.lastName),technicianId:a,action:t}});return n}),t=e.flat();return t}return[]},l=function(t){return t.map(function(t){var a=(0,S.default)(t.date).format("h:mm A MM/DD/YYYY"),n=C.technicianActionTypes[t.action.actionType];return v.default.createElement(V,{date:a,actionType:n,name:t.name,value:t,onClick:e.handlePopupOpen,position:t.action.location})})},c=(0,A.compose)((0,A.withProps)({googleMapURL:"https://maps.googleapis.com/maps/api/js?key=AIzaSyDdCuc9RtkM-9wV9e3OrULPj67g2CHIdZI&v=3.exp&libraries=geometry,drawing,places,visualization",loadingElement:v.default.createElement("div",{style:{height:"100%"}}),containerElement:v.default.createElement("div",{style:{height:"400px"}}),mapElement:v.default.createElement("div",{style:{height:"100%",width:"100%"}})}),w.withScriptjs,w.withGoogleMap)(function(e){var t=e.center,a=e.markers;return v.default.createElement(w.GoogleMap,{defaultZoom:13,center:t||N},a)}),s=this.props.geo,o=s.area&&s.area.center,u=r(),d=l(u);return v.default.createElement(M.default,null,v.default.createElement(i.default,null,v.default.createElement(p.default,{tabBarExtraContent:n,size:"large",tabBarStyle:{marginBottom:24}},v.default.createElement(R,{tab:"Technicians",key:"Technicians"},v.default.createElement(I.default,{data:{list:this.props.performance.technicianMetricsData},columns:this.columns,scroll:{x:1300}})),v.default.createElement(R,{tab:"Action Map",key:"Map"},v.default.createElement(c,{center:o,markers:d})))))}}]),t}(v.Component))||g),F=B;t.default=F}}]);