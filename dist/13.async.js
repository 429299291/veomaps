(window["webpackJsonp"]=window["webpackJsonp"]||[]).push([[13],{"m1+7":function(e,t,a){e.exports={tableList:"antd-pro-pages-vehicle-vehicle-tableList",tableListOperator:"antd-pro-pages-vehicle-vehicle-tableListOperator",tableListForm:"antd-pro-pages-vehicle-vehicle-tableListForm",submitButtons:"antd-pro-pages-vehicle-vehicle-submitButtons"}},nAvq:function(e,t,a){"use strict";var l=a("TqRt"),r=a("284h");Object.defineProperty(t,"__esModule",{value:!0}),t.default=void 0;var n=l(a("pVnL"));a("IzEo");var d=l(a("bx4M"));a("sRBo");var i=l(a("kaz8"));a("giR+");var u=l(a("fyUT"));a("Pwec");var c=l(a("CtXQ"));a("+L6B");var o=l(a("2/Rp"));a("14J3");var s=l(a("BMrR"));a("jCWc");var f=l(a("kPKH")),m=l(a("MVZn"));a("/zsF");var p=l(a("PArb")),h=l(a("lwsE")),v=l(a("W8MJ")),E=l(a("a1gu")),b=l(a("Nsbk")),g=l(a("7W2i"));a("2qtc");var y=l(a("kLXV"));a("7Kak");var S=l(a("9yH6"));a("OaEy");var k=l(a("2fM7"));a("5NDa");var C=l(a("5rEg"));a("FJo9");var w=l(a("L41K"));a("y8nQ");var V=l(a("Vl3Y"));a("Znn+");var I,M,A,F=l(a("ZTPi")),D=r(a("q1tI")),T=a("MuoO"),L=l(a("wd/R")),P=l(a("CkN6")),N=l(a("zHco")),R=l(a("m1+7")),x=a("0bUC"),B=(l(a("j+jj")),l(a("itZA"))),U=a("34ay"),Y=a("+n12"),O=l(a("fqRC")),H=F.default.TabPane,z=(0,U.getAuthority)(),q=V.default.Item,G=(w.default.Step,C.default.TextArea,k.default.Option),j=(S.default.Group,["Unlock","lock"]),K=["Bicycle","Scooter","E-Vehicle","Car"],W=["Normal","Error","Auto Error","Deactivated","Waiting for Activation"],J=function(e){var t=(0,L.default)(e).format("YYYY-MM-DD HH:mm:ss");return t},Z={vehicleId:"vehicleId",vehicleNumber:"vehicleNumber",vehicleType:"vehicleType",lockStatus:"lockStatus",isReported:"isReported",areaId:"areaId",imei:"imei",errorStatus:"errorStatus",connectStatus:"connectStatus",power:"power",vehiclePower:"vehiclePower",isTurnedOn:"isTurnedOn",heartTime:"heartTime",wirelessTech:"wirelessTech",mac:"mac",iccid:"iccid",firmware:"firmware",lat:"lat",lng:"lng",key:"vehicleId"},_=function(e){return e>=420?100:e<420&&e>=411?95+5*(e-411)/9:e<411&&e>=395?90+5*(e-395)/16:e<395&&e>=386?80+10*(e-386)/9:e<386&&e>=379?70+10*(e-379)/7:e<379&&e>=373?60+10*(e-373)/6:e<373&&e>=369?50+10*(e-369)/4:e<369&&e>=365?40+10*(e-365)/4:e<365&&e>=363?30+10*(e-363)/2:e<363&&e>=359?20+10*(e-359)/4:e<359&&e>=354?10+10*(e-354)/5:e<354&&e>340?10*(e-340)/14:0},Q=V.default.create()(function(e){var t=e.modalVisible,a=e.form,l=e.handleAdd,r=e.handleModalVisible,n=e.areas,d=function(){a.validateFields(function(e,t){e||(a.resetFields(),t.vehicleNumber=parseInt(t.vehicleNumber,10),l(t))})};return D.default.createElement(y.default,{destroyOnClose:!0,title:"Add",visible:t,onOk:d,onCancel:function(){return r()},width:"700px"},D.default.createElement(q,{labelCol:{span:5},wrapperCol:{span:15},label:"ID"},a.getFieldDecorator("vehicleNumber",{rules:[{required:!0,message:"At least 8 Digits!",min:1}]})(D.default.createElement(C.default,{placeholder:"Please Input"}))),D.default.createElement(q,{labelCol:{span:5},wrapperCol:{span:15},label:"IMEI"},a.getFieldDecorator("imei",{rules:[{required:!0,message:"At least 15 Digits!",min:1}]})(D.default.createElement(C.default,{placeholder:"Please Input"}))),D.default.createElement(q,{labelCol:{span:5},wrapperCol:{span:15},label:"Mac Address"},a.getFieldDecorator("mac",{rules:[{required:!0,message:"At least 8 Digits!",min:1}]})(D.default.createElement(C.default,{placeholder:"Please Input"}))),D.default.createElement(q,{labelCol:{span:5},wrapperCol:{span:15},label:"Type"},a.getFieldDecorator("vehicleType",{rules:[{required:!0,message:"You have pick a type"}]})(D.default.createElement(k.default,{placeholder:"select",style:{width:"100%"}},D.default.createElement(G,{value:"0"},"Bike"),D.default.createElement(G,{value:"1"},"Scooter"),D.default.createElement(G,{value:"2"},"E-Bike")))),n&&D.default.createElement(q,{labelCol:{span:5},wrapperCol:{span:15},label:"Area"},a.getFieldDecorator("areaId",{rules:[{required:!0,message:"You have pick a area"}]})(D.default.createElement(k.default,{placeholder:"select",style:{width:"100%"}},n.map(function(e){return D.default.createElement(G,{key:e.id,value:e.id},e.name)})))))}),X=V.default.create()(function(e){var t=e.form,a=e.modalVisible,l=e.handleUpdate,r=e.handleModalVisible,n=e.areas,d=e.record,i=function(){t.isFieldsTouched()?t.validateFields(function(e,a){e||(t.resetFields(),a.vehicleNumber=parseInt(a.vehicleNumber,10),l(d.id,a))}):r()};return D.default.createElement(y.default,{destroyOnClose:!0,title:"Update",visible:a,onOk:i,onCancel:function(){return r()}},D.default.createElement(q,{labelCol:{span:5},wrapperCol:{span:15},label:"ID"},t.getFieldDecorator("vehicleNumber",{rules:[{required:!0,message:"At least 8 Digits!",min:1}],initialValue:d.vehicleNumber+""})(D.default.createElement(C.default,{placeholder:"Please Input"}))),D.default.createElement(q,{labelCol:{span:5},wrapperCol:{span:15},label:"Lock Status"},t.getFieldDecorator("lockStatus",{initialValue:d.lockStatus})(D.default.createElement(k.default,{placeholder:"select",style:{width:"100%"}},D.default.createElement(G,{value:0},"Unlock"),D.default.createElement(G,{value:1},"Lock")))),D.default.createElement(q,{labelCol:{span:5},wrapperCol:{span:15},label:"Error Status"},t.getFieldDecorator("errorStatus",{initialValue:d.errorStatus})(D.default.createElement(k.default,{placeholder:"select",style:{width:"100%"}},W.map(function(e,t){return D.default.createElement(G,{key:t,value:t},e)})))),D.default.createElement(q,{labelCol:{span:5},wrapperCol:{span:15},label:"Type"},t.getFieldDecorator("vehicleType",{rules:[{required:!0,message:"You have pick a type"}],initialValue:d.vehicleType})(D.default.createElement(k.default,{placeholder:"select",style:{width:"100%"}},D.default.createElement(G,{value:0},"Bike"),D.default.createElement(G,{value:1},"Scooter"),D.default.createElement(G,{value:2},"E-Bike")))),n&&D.default.createElement(q,{labelCol:{span:5},wrapperCol:{span:15},label:"Area"},t.getFieldDecorator("areaId",{rules:[{required:!0,message:"You have pick a area"}],initialValue:d.areaId})(D.default.createElement(k.default,{placeholder:"select",style:{width:"100%"}},n.map(function(e){return D.default.createElement(G,{key:e.id,value:e.id},e.name)})))))}),$=(I=(0,T.connect)(function(e){var t=e.vehicles,a=e.areas,l=e.loading,r=e.geo;return{vehicles:t,areas:a.data,selectedAreaId:a.selectedAreaId,loading:l.models.vehicles,areaNames:a.areaNames,geo:r}}),M=V.default.create(),I(A=M(A=function(e){function t(){var e,a;(0,h.default)(this,t);for(var l=arguments.length,r=new Array(l),n=0;n<l;n++)r[n]=arguments[n];return a=(0,E.default)(this,(e=(0,b.default)(t)).call.apply(e,[this].concat(r))),a.state={modalVisible:!1,updateModalVisible:!1,detailModalVisible:!1,expandForm:!1,selectedRows:[],vehicleLocations:[],filterCriteria:{currentPage:1,pageSize:10},selectedRecord:{},selectedMarker:null,selectedTab:"1",shouldShowHeatMap:!1},a.columns=[{title:"ID",dataIndex:"vehicleNumber"},{title:"Power",dataIndex:"power",render:function(e){return D.default.createElement("p",null,(0,x.roundTo2Decimal)(_(e))+"%")}},{title:"Status",dataIndex:"connectStatus",render:function(e,t){return D.default.createElement(D.Fragment,null,D.default.createElement("span",null,j[t.lockStatus]),D.default.createElement(p.default,{type:"vertical"}),D.default.createElement("span",null,W[t.errorStatus]),D.default.createElement(p.default,{type:"vertical"}),D.default.createElement("span",null,a.isConnected(t)))}},{title:"HeartTime",dataIndex:"heartTime",sorter:!0,render:function(e){return D.default.createElement("span",null,J(e))}},{title:"Ride Count",dataIndex:"rideCount",sorter:!0,render:function(e){return D.default.createElement("span",null,e)}},{title:"Last Ride Time",dataIndex:"lastRideTime",sorter:!0,render:function(e){return D.default.createElement("span",null,(0,L.default)(e).format("YYYY-MM-DD HH:mm:ss"))}},{title:"Type",dataIndex:"vehicleType",render:function(e){return D.default.createElement("p",null,K[e])}},{title:"Vehicle Power",dataIndex:"vehiclePower",render:function(e){return D.default.createElement("p",null,"".concat(e,"%"))}},{title:"operation",render:function(e,t){return D.default.createElement(D.Fragment,null,D.default.createElement("a",{onClick:function(){return a.handleUpdateModalVisible(!0,t)}},"Update"),D.default.createElement(p.default,{type:"vertical"}),D.default.createElement("a",{onClick:function(){return a.handleDetailModalVisible(!0,t)}},"Detail"))}}],a.handleGetListVehicles=function(){var e=a.props.dispatch,t=a.state.filterCriteria;e({type:"vehicles/getCount",payload:t}),e({type:"vehicles/get",payload:t})},a.handleStandardTableChange=function(e,t,l){var r=a.props.dispatch,n=a.state.filterCriteria,d=(0,m.default)({},n);d.currentPage=e.current,d.pageSize=e.pageSize,l.field&&(d.sorter="".concat(l.field,"_").concat(l.order)),a.setState({filterCriteria:d}),r({type:"vehicles/get",payload:d})},a.handleFormReset=function(){var e=a.props,t=e.form,l=(e.dispatch,a.state.filterCriteria);t.resetFields();var r={currentPage:1,pageSize:l.pageSize};a.setState({filterCriteria:r},function(){return a.handleSearch()})},a.toggleForm=function(){var e=a.state.expandForm;a.setState({expandForm:!e})},a.handleSearch=function(e){"object"===typeof e&&e.preventDefault();var t=a.props,l=(t.dispatch,t.form),r=t.selectedAreaId,n=a.state,d=n.filterCriteria,i=n.selectedTab;l.validateFields(function(e,t){if(!e){var l=Object.assign({},d,t,{currentPage:1,pageSize:10,areaId:r});a.setState({filterCriteria:l},function(){switch(i){case"1":a.handleGetListVehicles();break;case"2":a.handleGetMapData();break;default:return}})}})},a.handleUpdateAllLocations=function(e){"object"===typeof e&&e.preventDefault();var t=a.props,l=t.dispatch,r=t.form,n=t.selectedAreaId,d=a.state,i=d.filterCriteria;d.selectedTab;r.validateFields(function(e,t){if(!e){var r=Object.assign({},i,t,{currentPage:1,pageSize:10,areaId:n});a.setState({filterCriteria:r},function(){return l({type:"vehicles/updateAllLocations",payload:i,areaId:n})})}})},a.handleModalVisible=function(e){a.setState({createModalVisible:!!e})},a.handleUpdateModalVisible=function(e,t){a.setState({updateModalVisible:!!e,selectedRecord:t||{}})},a.handleDetailModalVisible=function(e,t){a.setState({detailModalVisible:!!e,selectedRecord:t||{}})},a.handleDeleteModalVisible=function(e,t){a.setState({updateModalVisible:!!e,selectedRecord:t||{}})},a.handleAdd=function(e){var t=a.props.dispatch;t({type:"vehicles/add",payload:e}),a.handleModalVisible()},a.handleUpdate=function(e,t){var l=a.props.dispatch;l({type:"vehicles/update",payload:t,id:e,onSuccess:a.handleGetListVehicles}),a.handleUpdateModalVisible()},a.getAreaGeoInfo=function(){var e=a.props,t=e.dispatch,l=e.selectedAreaId;t({type:"geo/getFences",areaId:l}),t({type:"geo/getCenter",areaId:l})},a.setClickedMarker=function(e){a.setState({selectedMarker:e})},a.hadnleTabChange=function(e){a.setState({selectedTab:e},a.handleSearch)},a.getAreaStartPoints=function(){var e=a.props,t=e.dispatch,l=e.selectedAreaId;t({type:"vehicles/getStartPoints",areaId:l,onSuccess:function(e){return a.setState({areaStartPoints:e})}})},a.handleGetMapData=function(){var e=a.props.selectedAreaId;e>=1&&(a.getVehicleLocations(),a.getAreaGeoInfo(),z.includes("get.area.start.points")&&a.getAreaStartPoints())},a.formatCsvData=function(e){return e.map(function(e){return e.heartTime=(0,L.default)(e.heartTime).format("YYYY-MM-DD HH:mm:ss"),e})},a}return(0,g.default)(t,e),(0,v.default)(t,[{key:"componentDidMount",value:function(){this.handleSearch()}},{key:"isConnected",value:function(e){var t=L.default.utc(),a=L.default.utc(e.heartTime);return t.diff(a,"minutes")<10?"online":"offline"}},{key:"componentDidUpdate",value:function(e,t,a){e.selectedAreaId!==this.props.selectedAreaId&&this.handleSearch()}},{key:"renderSimpleForm",value:function(){var e=this.props.form.getFieldDecorator;return D.default.createElement(V.default,{onSubmit:this.handleSearch,layout:"inline"},D.default.createElement(s.default,{gutter:{md:8,lg:24,xl:48}},D.default.createElement(f.default,{md:8,sm:24},D.default.createElement(q,{label:"Keywords"},e("numberOrImei")(D.default.createElement(C.default,{placeholder:"number or imei"})))),D.default.createElement(f.default,{md:8,sm:24},D.default.createElement(q,{label:"Battery Status"},e("lockPower")(D.default.createElement(k.default,{placeholder:"select",style:{width:"100%"}},D.default.createElement(G,{value:"0"},"Low Battery"),D.default.createElement(G,{value:"1"},"Full Battery"),D.default.createElement(G,{value:null},"All"))))),D.default.createElement(f.default,{md:8,sm:24},D.default.createElement(q,{label:"Error Status"},e("errorStatus",{initialValue:["0","1","2","4"]})(D.default.createElement(k.default,{mode:"multiple",placeholder:"select",style:{width:"100%"}},D.default.createElement(G,{value:"0"},"Normal"),D.default.createElement(G,{value:"1"},"Error"),D.default.createElement(G,{value:"2"},"Auto Error"),D.default.createElement(G,{value:"3"},"Deactivated"),D.default.createElement(G,{value:"4"},"Waiting for Activation")))))),D.default.createElement("div",{style:{overflow:"hidden"}},D.default.createElement("div",{style:{float:"right",marginBottom:24}},D.default.createElement(o.default,{type:"primary",htmlType:"submit"},"Search"),D.default.createElement(o.default,{style:{marginLeft:8},onClick:this.handleFormReset},"Reset"),D.default.createElement("a",{style:{marginLeft:8},onClick:this.toggleForm},"more ",D.default.createElement(c.default,{type:"down"})))))}},{key:"renderAdvancedForm",value:function(){var e=this.props.form.getFieldDecorator,t=(this.props.areas,function(e,t,a){console.log(t),void 0===t||t>0&&Number.isInteger(t)?a():a("Number must be larger than zero.")});return D.default.createElement(V.default,{onSubmit:this.handleSearch,layout:"inline"},D.default.createElement(s.default,{gutter:{md:8,lg:24,xl:48}},D.default.createElement(f.default,{md:8,sm:24},D.default.createElement(q,{label:"Keywords"},e("numberOrImei")(D.default.createElement(C.default,{placeholder:"number or imei"})))),D.default.createElement(f.default,{md:8,sm:24},D.default.createElement(q,{label:"Lock Battery Status"},e("lockPower")(D.default.createElement(k.default,{placeholder:"select",style:{width:"100%"}},D.default.createElement(G,{value:"0"},"Low Battery"),D.default.createElement(G,{value:"1"},"Full Battery"),D.default.createElement(G,{value:null},"All"))))),D.default.createElement(f.default,{md:8,sm:24},D.default.createElement(q,{label:"Error Status"},e("errorStatus",{initialValue:["0","1","2","4"]})(D.default.createElement(k.default,{mode:"multiple",placeholder:"select",style:{width:"100%"}},D.default.createElement(G,{value:"0"},"Normal"),D.default.createElement(G,{value:"1"},"Error"),D.default.createElement(G,{value:"2"},"Auto Error"),D.default.createElement(G,{value:"3"},"Deactivated"),D.default.createElement(G,{value:"4"},"Waiting for Activation")))))),D.default.createElement(s.default,{gutter:{md:8,lg:24,xl:48}},D.default.createElement(f.default,{md:8,sm:24},D.default.createElement(q,{label:"Lock Status"},e("lockStatus")(D.default.createElement(k.default,{placeholder:"select",style:{width:"100%"}},D.default.createElement(G,{value:"0"},"Unlock"),D.default.createElement(G,{value:"1"},"Lock"),D.default.createElement(G,{value:null},"All"))))),D.default.createElement(f.default,{md:8,sm:24},D.default.createElement(q,{label:"Vehicle Type"},e("vehicleType")(D.default.createElement(k.default,{placeholder:"select",style:{width:"100%"}},D.default.createElement(G,{value:"0"},"Bike"),D.default.createElement(G,{value:"1"},"Scooter"),D.default.createElement(G,{value:"2"},"e-bike"),D.default.createElement(G,{value:null},"All"))))),D.default.createElement(f.default,{md:8,sm:24},D.default.createElement(q,{label:"Connection Status"},e("connectStatus")(D.default.createElement(k.default,{placeholder:"select",style:{width:"100%"}},D.default.createElement(G,{value:"0"},"offline"),D.default.createElement(G,{value:"1"},"online"),D.default.createElement(G,{value:null},"All")))))),D.default.createElement(s.default,{gutter:{md:8,lg:24,xl:48}},D.default.createElement(f.default,{md:8,sm:24},D.default.createElement(q,{label:"Is Using"},e("isUsing")(D.default.createElement(k.default,{placeholder:"select",style:{width:"100%"}},D.default.createElement(G,{value:!0},"Yes"),D.default.createElement(G,{value:!1},"No"),D.default.createElement(G,{value:null},"All"))))),D.default.createElement(f.default,{md:8,sm:24},D.default.createElement(q,{label:"Vehicle Power Status"},e("vehiclePower")(D.default.createElement(k.default,{placeholder:"select",style:{width:"100%"}},D.default.createElement(G,{value:"0"},"Low Battery"),D.default.createElement(G,{value:"1"},"Full Battery"),D.default.createElement(G,{value:null},"All"))))),D.default.createElement(f.default,{md:8,sm:24},D.default.createElement(q,{labelCol:{span:5},wrapperCol:{span:15},label:"Idle Days"},e("idelDays",{rules:[{validator:t}]})(D.default.createElement(u.default,{placeholder:"Please Input"}))))),D.default.createElement(s.default,{gutter:{md:8,lg:24,xl:48}},D.default.createElement(f.default,{md:8,sm:24},D.default.createElement(q,{label:"Is Reported"},e("isReported")(D.default.createElement(k.default,{placeholder:"select",style:{width:"100%"}},D.default.createElement(G,{value:!0},"Yes"),D.default.createElement(G,{value:!1},"No"),D.default.createElement(G,{value:null},"All")))))),D.default.createElement("div",{style:{overflow:"hidden"}},D.default.createElement("div",{style:{float:"right",marginBottom:24}},D.default.createElement(o.default,{type:"primary",htmlType:"submit"},"Search"),D.default.createElement(o.default,{style:{marginLeft:8},onClick:this.handleFormReset},"Reset"),D.default.createElement("a",{style:{marginLeft:8},onClick:this.toggleForm},"close ",D.default.createElement(c.default,{type:"up"})))))}},{key:"renderForm",value:function(){var e=this.state.expandForm;return e?this.renderAdvancedForm():this.renderSimpleForm()}},{key:"getVehicleLocations",value:function(){var e=this,t=this.props,a=t.dispatch,l=(t.selectedAreaId,this.state.filterCriteria);a({type:"vehicles/getVehicleLocation",payload:l,onSuccess:function(t){return e.setState({vehicleLocations:t})}})}},{key:"render",value:function(){var e=this,t=this.props,a=t.vehicles,l=t.areas,r=t.loading,u=t.selectedAreaId,c=t.geo,s=t.areaNames,f=c.area&&c.area.center,m=c.fences,p=this.state,h=p.createModalVisible,v=p.updateModalVisible,E=p.detailModalVisible,b=p.selectedRecord,g=p.filterCriteria,y=p.selectedMarker,S=p.selectedTab,k=p.vehicleLocations,C=p.areaStartPoints,w=p.shouldShowHeatMap,V={handleAdd:this.handleAdd,handleModalVisible:this.handleModalVisible},I={handleModalVisible:this.handleUpdateModalVisible,handleUpdate:this.handleUpdate},M={defaultCurrent:1,current:g.currentPage,pageSize:g.pageSize,total:a.total};return D.default.createElement(N.default,{title:"Vehicle List"},D.default.createElement(d.default,{bordered:!1},D.default.createElement("div",{className:R.default.tableList},D.default.createElement("div",{className:R.default.tableListForm},this.renderForm()),D.default.createElement("div",{className:R.default.tableListOperator},D.default.createElement(o.default,{icon:"plus",type:"primary",onClick:function(){return e.handleModalVisible(!0)}},"Add"),u>=1&&z.includes("update.all.vehicle.location")&&D.default.createElement(o.default,{type:"primary",onClick:function(){return e.handleUpdateAllLocations()}},"Update All Locations"),D.default.createElement("span",{style:{marginLeft:"1em"}},"count: ".concat("1"===S?a.total:k.length))),D.default.createElement(F.default,{defaultActiveKey:"1",onChange:this.hadnleTabChange},D.default.createElement(H,{tab:"List View",key:"1"},D.default.createElement(P.default,{loading:r,data:{list:a.data,pagination:M},columns:this.columns,onChange:this.handleStandardTableChange,scroll:{x:1300}})),u>=1&&D.default.createElement(H,{tab:"Map View",key:"2"},f&&m&&D.default.createElement(O.default,{center:f,vehicles:k,fences:m,heatMapData:C,shouldShowHeatMap:w,vehicleTypeFilter:{unlock:!0,lock:!0,lowBattery:!0,error:!0,errorUnlock:!0,ebike:!0},setClickedMarker:this.setClickedMarker,selectedMarker:y}),k.length>0&&D.default.createElement("div",null,D.default.createElement(o.default,{style:{marginTop:"1em"},onClick:function(){return(0,Y.exportCSVFile)(Z,e.formatCsvData(k),s[u])}},"Export"),z.includes("get.area.start.points")&&D.default.createElement(i.default,{style:{marginTop:"1em",marginLeft:"1em"},defaultValue:w,onChange:function(t){return e.setState({shouldShowHeatMap:t.target.checked})}},"Show HeatMap")))))),D.default.createElement(Q,(0,n.default)({},V,{modalVisible:h,areas:l})),D.default.createElement(X,(0,n.default)({},I,{modalVisible:v,record:b,areas:l})),E&&D.default.createElement(B.default,{isVisible:E,handleDetailVisible:this.handleDetailModalVisible,vehicleId:b.id,handleGetVehicles:this.handleGetListVehicles}))}}]),t}(D.PureComponent))||A)||A),ee=$;t.default=ee}}]);